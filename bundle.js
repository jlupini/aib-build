(()=>{"use strict";var t={11:(t,e,o)=>{o.d(e,{A:()=>f});var n=o(601),i=o.n(n),r=o(314),a=o.n(r),s=o(417),c=o.n(s),l=new URL(o(489),o.b),u=new URL(o(487),o.b),h=a()(i()),d=c()(l),p=c()(u);h.push([t.id,`body{background-color:#faf9f7;margin:0;font-family:"p22-mackinac-pro",serif;font-weight:400;font-style:normal;overflow-y:hidden}body.body-scroll{overflow-y:auto}body.body-scroll main{height:auto;overflow-y:unset}nav{background-color:#faf9f7;box-shadow:0 2px 4px 0 rgba(0,0,0,.1);padding:22px 0;position:fixed;left:0;width:100%;z-index:1000;top:0;display:flex;position:sticky;top:0;z-index:1000}main{padding:0 0;position:relative;z-index:500;height:calc(100vh - 100px - 44px);overflow-y:auto}main::after{content:"";border-right:10px dashed #dad9d8;display:block;width:20%;height:100%;left:17px;top:0;position:absolute}main.side-view>.sticky-wrapper{min-height:1000px;width:40%;margin-left:22px;position:relative}main.side-view>.sticky-wrapper::after{content:"";border:2px solid rgba(218,217,216,.3);border-left:none;border-right:none;display:block;width:calc(50% + 22px);left:-22px;top:-10px;bottom:90px;position:absolute}main.side-view>.sticky-wrapper .content-block{position:sticky;top:122px;width:auto;margin:0 0 160px}main.side-view #chart1{top:0;right:0;left:auto;width:calc(100% - 40% - 22px);height:100vh;z-index:-1}main .content-block{pointer-events:auto}main .spacer-block{height:1000px}.content-block{position:relative;top:0;z-index:800;background-color:hsla(0,0%,100%,.5);padding:30px 30px 20px;width:50%;margin:200px auto 1000px;box-shadow:0 0 4px 0 rgba(0,0,0,.1);backdrop-filter:blur(3px);transition:background-color .3s}.content-block:hover{background-color:hsla(0,0%,100%,.8)}.content-block.no-bg{background-color:rgba(0,0,0,0);box-shadow:none;backdrop-filter:none}.content-block:first-child{margin-top:0;width:90%;line-height:.9}.content-block.short{margin-bottom:0}.content-block.medium{margin-bottom:100px}.content-block.width-medium{width:70%}.content-block .left-container{width:fit-content;margin:10px auto;padding:10px}.content-block .left-container.legend{background-color:#faf9f7;border:1px solid #231f20;border-radius:4px}.content-block .left-container>*{text-align:left}.content-block .left-container>h1,.content-block .left-container h2,.content-block .left-container h3,.content-block .left-container h4,.content-block .left-container h5{margin:.1em 0}.color-wrapper{display:flex;justify-content:space-between;margin:0 auto 400px;width:100%;position:relative;z-index:500;backdrop-filter:blur(2px)}.color-wrapper .content-block.no-bg{backdrop-filter:inherit}.color-wrapper.behind{z-index:-200}.color-wrapper>div{flex:1 1 auto;margin:0 10px;z-index:500}.color-wrapper:first-child{padding-top:100px}.color-wrapper.lavender{background-color:rgba(226,160,255,.7)}.color-wrapper .scroll-arrow::after{opacity:.3}.content-block:hover .scroll-arrow::after{opacity:.3}.content-block:hover .scroll-arrow:hover::after{opacity:1}.scroll-arrow{height:50px;width:100px;position:relative;top:0;left:50%;transform:translateX(-50%);z-index:1000;cursor:pointer}.scroll-arrow::after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:url(${d}) no-repeat center;background-size:100% auto;opacity:.05;transition:opacity .3s ease-out}.scroll-arrow.plum::after{background-image:url(${p})}.scroll-arrow.small{height:25px;width:50px}.scroll-arrow:hover::after{opacity:1;animation:move-up-down 1.5s ease-in-out infinite forwards}@keyframes move-up-down{0%,100%{transform:translate(0, 0)}50%{transform:translate(0, 7px)}}.inline-voter-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin:0 5px}.inline-voter-dot.purple{background-color:#833b8d}.inline-voter-dot.grey{background-color:#ababab}#controls{display:flex;position:relative;width:auto;flex:1 1 auto;text-align:right}#controls>*{flex:1 1 auto;margin:5px 10px}#controls .stop-button{background-color:#f33;color:#fff;font-weight:bold;padding:10px 15px;border:none;border-radius:5px;cursor:pointer;transition:background-color .3s ease}#controls .stop-button:hover{background-color:red}#controls .stop-button.active{background-color:#0a0}#controls .stop-button.active:hover{background-color:#0c0}#controls .save-button{background-color:#36f;color:#fff;font-weight:bold;padding:10px 15px;border:none;border-radius:5px;cursor:pointer;transition:background-color .3s ease}#controls .save-button:hover{background-color:#04c}.aib-logo{text-align:left;height:52px}.aib-logo img{display:inline-block;margin:0 auto;padding:0 20px;height:100%}#chart1{position:fixed;padding-top:100px;left:0;top:0;width:100%;height:100vh;z-index:100}svg{overflow:visible;position:absolute;left:50%;top:50%;transform:translate(-50%, -50%)}.flow-arrowhead{fill:currentColor}.flow-path{stroke:currentColor;stroke-width:1}.flow-circle{fill:currentColor}.link.highlight-path{stroke-linecap:round;z-index:10}.link.animated-flow .flow-circle-1{animation:flow-animation 2s infinite;animation-delay:0s}.link.animated-flow .flow-circle-2{animation:flow-animation 2s infinite;animation-delay:.5s}.link.animated-flow .flow-circle-3{animation:flow-animation 2s infinite;animation-delay:1s}.link.animated-flow .flow-circle-4{animation:flow-animation 2s infinite;animation-delay:1.5s}.flow-circle{fill:currentColor;stroke:none}.link.flow-dashed{stroke-dasharray:70 10;animation:dash-animation 60s linear infinite}.offset-arrow-path{fill:none;stroke-width:4px;stroke-linecap:butt;stroke-linejoin:round;pointer-events:none}.link.animated-flow-markers{marker-mid:url(#animated-flow);marker-start:url(#animated-flow);marker-end:url(#animated-flow)}@keyframes flow-animation{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes dash-animation{to{stroke-dashoffset:-1000}}svg text{font-family:"p22-mackinac-pro",serif}svg text.superdot-label{font-size:1.5rem;font-weight:700;fill:#231f20}svg text.image-label{font-size:1.5rem;font-weight:700;fill:#231f20}svg text.sankey-label{font-size:1.5rem;font-weight:700;fill:#231f20}svg text.parties-label{font-size:1.5rem;font-weight:700;fill:#460000}svg text.donors-label{font-size:1.5rem;font-weight:700;fill:#034238}.d3-annotations .annotation-note-bg{fill:hsla(0,0%,100%,.9)}.d3-annotations .annotation-note-title{font-weight:bold;font-family:"p22-mackinac-pro",serif;font-size:1.5rem;fill:#333}.d3-annotations .annotation-note-label{font-family:"p22-mackinac-pro",serif;font-size:1rem;fill:#555}.d3-annotations .annotation-connector path{stroke:#333;stroke-width:1.5px}.d3-annotations.show-bg .annotation-note-bg{fill:rgba(245,245,245,.9);stroke:#969696;stroke-width:1px}.d3-annotations.superdot-annotation .annotation-note-title{fill:#460000}.d3-annotations.sankey-annotation .annotation-connector path{stroke:#034238}.d3-annotations.annotation-narrow .annotation-note-content{max-width:120px}.d3-annotations.annotation-wide .annotation-note-content{max-width:300px}.d3-annotations .hidden-callout-annotation>.annotation-connector,.d3-annotations .hidden-callout-annotation>.annotation-note{display:none}.d3-annotations .hidden-circle-annotation .annotation-subject path{stroke:hsla(0,0%,100%,0)}.d3-annotations .hidden-line-annotation .annotation-connector path{stroke:hsla(0,0%,100%,0)}.d3-annotations .elite-donors-annotation .annotation-note-title{fill:#034238}.d3-annotations .elite-donors-annotation .annotation-connector path{stroke:#034238;stroke-width:2px}.d3-annotations .elite-donors-annotation .annotation-subject path{stroke:rgba(3,66,56,.5);stroke-width:4px;stroke-dasharray:5,5}.d3-annotations .purple-annotation .annotation-note-bg{fill:rgba(251,220,255,.8)}.d3-annotations .gold-annotation .annotation-note-bg{fill:rgba(255,200,3,.7)}.d3-annotations .teal-annotation .annotation-note-bg{fill:rgba(196,245,233,.8)}.d3-annotations .green-flow-annotation .annotation-note-bg{fill:rgba(200,252,192,.7)}.d3-annotations .blue-flow-annotation .annotation-note-bg{fill:rgba(184,206,250,.7)}.d3-annotations .donors-annotation .annotation-note-bg{fill:rgba(213,235,252,.8)}.d3-annotations .other-donors-annotation .annotation-note-title{fill:#460000}.d3-annotations .other-donors-annotation .annotation-connector path{stroke:#460000;stroke-width:2px}.d3-annotations .other-donors-annotation .annotation-subject path{stroke:rgba(70,0,0,.5);stroke-width:4px;stroke-dasharray:5,5}.font-book{font-family:"p22-mackinac-pro",serif;font-weight:400;font-style:normal}.font-book-italic{font-family:"p22-mackinac-pro",serif;font-weight:400;font-style:italic}.font-medium{font-family:"p22-mackinac-pro",serif;font-weight:500;font-style:normal}.font-medium-italic{font-family:"p22-mackinac-pro",serif;font-weight:500;font-style:italic}.font-bold{font-family:"p22-mackinac-pro",serif;font-weight:700;font-style:normal}.font-bold-italic{font-family:"p22-mackinac-pro",serif;font-weight:700;font-style:italic}.font-extra-bold{font-family:"p22-mackinac-pro",serif;font-weight:800;font-style:normal}.font-extra-bold-italic{font-family:"p22-mackinac-pro",serif;font-weight:800;font-style:italic}#dot-info{position:fixed;right:0;top:100px;padding:10px;background-color:hsla(0,0%,100%,.2);border-radius:5px;box-shadow:0 0 4px 0 rgba(0,0,0,.1);z-index:1000}footer{background-color:#faf9f7;box-shadow:0 -2px 4px 0 rgba(0,0,0,.1);padding:22px 0;position:fixed;left:0;width:100%;z-index:1000;bottom:0;display:flex;position:sticky;bottom:0;z-index:1000}footer>.footer-data-item{display:flex}footer>.footer-data-item>div{flex:1 1 auto;margin:0 10px}h1{font-family:"ringold-sans",sans-serif;font-weight:400;font-style:normal;font-size:5.5rem;margin:0 0 20px}h2{font-family:"ringold-sans",sans-serif;font-weight:400;font-style:normal;font-size:3.5rem;margin:0 0 20px;line-height:1.1}h3{font-family:"p22-mackinac-pro",serif;font-weight:400;font-style:normal;font-size:1.5rem;margin:0 0 20px}h1,h2,h3,h4,h5,h6,p{text-align:center}.text-lemon{color:#ffdd2b}.text-lavender{color:#e2a0ff}.text-dark{color:#231f20}.text-plum{color:#460000}.text-pear{color:#b5c716}.text-grape{color:#473198}.text-mint{color:#034238}.text-light{color:#faf9f7}.text-stroke-dark{-webkit-text-stroke:2px #231f20}::-webkit-scrollbar{width:12px;background-color:#ffdd2b;z-index:9000}::-webkit-scrollbar-thumb{background-color:#231f20;border-radius:10px;border:3px solid rgba(0,0,0,0)}::-webkit-scrollbar-track{background-color:#ffdd2b;border-radius:10px;z-index:9000}*{scrollbar-width:thin;scrollbar-color:#231f20 #ffdd2b}`,""]);const f=h},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o="",n=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),n&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=t(e),n&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o})).join("")},e.i=function(t,o,n,i,r){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);n&&a[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),o&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=o):u[2]=o),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),e.push(u))}},e}},417:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},601:t=>{t.exports=function(t){return t[1]}},948:(t,e,o)=>{o.r(e),o.d(e,{annotation:()=>Ze,annotationBadge:()=>Be,annotationCallout:()=>Ue,annotationCalloutCircle:()=>Fe,annotationCalloutCurve:()=>$e,annotationCalloutElbow:()=>ze,annotationCalloutRect:()=>Ye,annotationCustomType:()=>Ie,annotationLabel:()=>je,annotationTypeBase:()=>Me,annotationXYThreshold:()=>qe,default:()=>Qe});var n="http://www.w3.org/1999/xhtml";const i={svg:"http://www.w3.org/2000/svg",xhtml:n,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function r(t){var e=t+="",o=e.indexOf(":");return o>=0&&"xmlns"!==(e=t.slice(0,o))&&(t=t.slice(o+1)),i.hasOwnProperty(e)?{space:i[e],local:t}:t}function a(t){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===n&&e.documentElement.namespaceURI===n?e.createElement(t):e.createElementNS(o,t)}}function s(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function c(t){var e=r(t);return(e.local?s:a)(e)}function l(){}function u(t){return null==t?l:function(){return this.querySelector(t)}}function h(){return[]}function d(t){return new Array(t.length)}function p(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function f(t,e,o,n,i,r){for(var a,s=0,c=e.length,l=r.length;s<l;++s)(a=e[s])?(a.__data__=r[s],n[s]=a):o[s]=new p(t,r[s]);for(;s<c;++s)(a=e[s])&&(i[s]=a)}function y(t,e,o,n,i,r,a){var s,c,l,u={},h=e.length,d=r.length,f=new Array(h);for(s=0;s<h;++s)(c=e[s])&&(f[s]=l="$"+a.call(c,c.__data__,s,e),l in u?i[s]=c:u[l]=c);for(s=0;s<d;++s)(c=u[l="$"+a.call(t,r[s],s,r)])?(n[s]=c,c.__data__=r[s],u[l]=null):o[s]=new p(t,r[s]);for(s=0;s<h;++s)(c=e[s])&&u[f[s]]===c&&(i[s]=c)}function g(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function _(t){return function(){this.removeAttribute(t)}}function m(t){return function(){this.removeAttributeNS(t.space,t.local)}}function x(t,e){return function(){this.setAttribute(t,e)}}function v(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function O(t,e){return function(){var o=e.apply(this,arguments);null==o?this.removeAttribute(t):this.setAttribute(t,o)}}function w(t,e){return function(){var o=e.apply(this,arguments);null==o?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,o)}}function b(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function S(t){return function(){this.style.removeProperty(t)}}function k(t,e,o){return function(){this.style.setProperty(t,e,o)}}function E(t,e,o){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,o)}}function R(t){return function(){delete this[t]}}function T(t,e){return function(){this[t]=e}}function N(t,e){return function(){var o=e.apply(this,arguments);null==o?delete this[t]:this[t]=o}}function P(t){return t.trim().split(/^|\s+/)}function A(t){return t.classList||new G(t)}function G(t){this._node=t,this._names=P(t.getAttribute("class")||"")}function D(t,e){for(var o=A(t),n=-1,i=e.length;++n<i;)o.add(e[n])}function V(t,e){for(var o=A(t),n=-1,i=e.length;++n<i;)o.remove(e[n])}function C(t){return function(){D(this,t)}}function M(t){return function(){V(this,t)}}function I(t,e){return function(){(e.apply(this,arguments)?D:V)(this,t)}}function L(){this.textContent=""}function j(t){return function(){this.textContent=t}}function U(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function z(){this.innerHTML=""}function $(t){return function(){this.innerHTML=t}}function B(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function F(){this.nextSibling&&this.parentNode.appendChild(this)}function Y(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function H(){return null}function q(){var t=this.parentNode;t&&t.removeChild(this)}function W(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function X(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}p.prototype={constructor:p,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},G.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var J={},K=null;function Z(t,e,o){return t=Q(t,e,o),function(e){var o=e.relatedTarget;o&&(o===this||8&o.compareDocumentPosition(this))||t.call(this,e)}}function Q(t,e,o){return function(n){var i=K;K=n;try{t.call(this,this.__data__,e,o)}finally{K=i}}}function tt(t){return function(){var e=this.__on;if(e){for(var o,n=0,i=-1,r=e.length;n<r;++n)o=e[n],t.type&&o.type!==t.type||o.name!==t.name?e[++i]=o:this.removeEventListener(o.type,o.listener,o.capture);++i?e.length=i:delete this.__on}}}function et(t,e,o){var n=J.hasOwnProperty(t.type)?Z:Q;return function(i,r,a){var s,c=this.__on,l=n(e,r,a);if(c)for(var u=0,h=c.length;u<h;++u)if((s=c[u]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=o),void(s.value=e);this.addEventListener(t.type,l,o),s={type:t.type,name:t.name,value:e,listener:l,capture:o},c?c.push(s):this.__on=[s]}}function ot(t,e,o,n){var i=K;t.sourceEvent=K,K=t;try{return e.apply(o,n)}finally{K=i}}function nt(t,e,o){var n=b(t),i=n.CustomEvent;"function"==typeof i?i=new i(e,o):(i=n.document.createEvent("Event"),o?(i.initEvent(e,o.bubbles,o.cancelable),i.detail=o.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function it(t,e){return function(){return nt(this,t,e)}}function rt(t,e){return function(){return nt(this,t,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(J={mouseenter:"mouseover",mouseleave:"mouseout"}));var at=[null];function st(t,e){this._groups=t,this._parents=e}function ct(t){return"string"==typeof t?new st([[document.querySelector(t)]],[document.documentElement]):new st([[t]],at)}st.prototype=function(){return new st([[document.documentElement]],at)}.prototype={constructor:st,select:function(t){"function"!=typeof t&&(t=u(t));for(var e=this._groups,o=e.length,n=new Array(o),i=0;i<o;++i)for(var r,a,s=e[i],c=s.length,l=n[i]=new Array(c),h=0;h<c;++h)(r=s[h])&&(a=t.call(r,r.__data__,h,s))&&("__data__"in r&&(a.__data__=r.__data__),l[h]=a);return new st(n,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?h:function(){return this.querySelectorAll(t)}}(t));for(var e=this._groups,o=e.length,n=[],i=[],r=0;r<o;++r)for(var a,s=e[r],c=s.length,l=0;l<c;++l)(a=s[l])&&(n.push(t.call(a,a.__data__,l,s)),i.push(a));return new st(n,i)},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,o=e.length,n=new Array(o),i=0;i<o;++i)for(var r,a=e[i],s=a.length,c=n[i]=[],l=0;l<s;++l)(r=a[l])&&t.call(r,r.__data__,l,a)&&c.push(r);return new st(n,this._parents)},data:function(t,e){if(!t)return g=new Array(this.size()),u=-1,this.each((function(t){g[++u]=t})),g;var o,n=e?y:f,i=this._parents,r=this._groups;"function"!=typeof t&&(o=t,t=function(){return o});for(var a=r.length,s=new Array(a),c=new Array(a),l=new Array(a),u=0;u<a;++u){var h=i[u],d=r[u],p=d.length,g=t.call(h,h&&h.__data__,u,i),_=g.length,m=c[u]=new Array(_),x=s[u]=new Array(_);n(h,d,m,x,l[u]=new Array(p),g,e);for(var v,O,w=0,b=0;w<_;++w)if(v=m[w]){for(w>=b&&(b=w+1);!(O=x[b])&&++b<_;);v._next=O||null}}return(s=new st(s,i))._enter=c,s._exit=l,s},enter:function(){return new st(this._enter||this._groups.map(d),this._parents)},exit:function(){return new st(this._exit||this._groups.map(d),this._parents)},join:function(t,e,o){var n=this.enter(),i=this,r=this.exit();return n="function"==typeof t?t(n):n.append(t+""),null!=e&&(i=e(i)),null==o?r.remove():o(r),n&&i?n.merge(i).order():i},merge:function(t){for(var e=this._groups,o=t._groups,n=e.length,i=o.length,r=Math.min(n,i),a=new Array(n),s=0;s<r;++s)for(var c,l=e[s],u=o[s],h=l.length,d=a[s]=new Array(h),p=0;p<h;++p)(c=l[p]||u[p])&&(d[p]=c);for(;s<n;++s)a[s]=e[s];return new st(a,this._parents)},order:function(){for(var t=this._groups,e=-1,o=t.length;++e<o;)for(var n,i=t[e],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&4^n.compareDocumentPosition(a)&&a.parentNode.insertBefore(n,a),a=n);return this},sort:function(t){function e(e,o){return e&&o?t(e.__data__,o.__data__):!e-!o}t||(t=g);for(var o=this._groups,n=o.length,i=new Array(n),r=0;r<n;++r){for(var a,s=o[r],c=s.length,l=i[r]=new Array(c),u=0;u<c;++u)(a=s[u])&&(l[u]=a);l.sort(e)}return new st(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,o=t.length;e<o;++e)for(var n=t[e],i=0,r=n.length;i<r;++i){var a=n[i];if(a)return a}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,o=0,n=e.length;o<n;++o)for(var i,r=e[o],a=0,s=r.length;a<s;++a)(i=r[a])&&t.call(i,i.__data__,a,r);return this},attr:function(t,e){var o=r(t);if(arguments.length<2){var n=this.node();return o.local?n.getAttributeNS(o.space,o.local):n.getAttribute(o)}return this.each((null==e?o.local?m:_:"function"==typeof e?o.local?w:O:o.local?v:x)(o,e))},style:function(t,e,o){return arguments.length>1?this.each((null==e?S:"function"==typeof e?E:k)(t,e,null==o?"":o)):function(t,e){return t.style.getPropertyValue(e)||b(t).getComputedStyle(t,null).getPropertyValue(e)}(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?R:"function"==typeof e?N:T)(t,e)):this.node()[t]},classed:function(t,e){var o=P(t+"");if(arguments.length<2){for(var n=A(this.node()),i=-1,r=o.length;++i<r;)if(!n.contains(o[i]))return!1;return!0}return this.each(("function"==typeof e?I:e?C:M)(o,e))},text:function(t){return arguments.length?this.each(null==t?L:("function"==typeof t?U:j)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?z:("function"==typeof t?B:$)(t)):this.node().innerHTML},raise:function(){return this.each(F)},lower:function(){return this.each(Y)},append:function(t){var e="function"==typeof t?t:c(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var o="function"==typeof t?t:c(t),n=null==e?H:"function"==typeof e?e:u(e);return this.select((function(){return this.insertBefore(o.apply(this,arguments),n.apply(this,arguments)||null)}))},remove:function(){return this.each(q)},clone:function(t){return this.select(t?X:W)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,o){var n,i,r=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",o=t.indexOf(".");return o>=0&&(e=t.slice(o+1),t=t.slice(0,o)),{type:t,name:e}}))}(t+""),a=r.length;if(!(arguments.length<2)){for(s=e?et:tt,null==o&&(o=!1),n=0;n<a;++n)this.each(s(r[n],e,o));return this}var s=this.node().__on;if(s)for(var c,l=0,u=s.length;l<u;++l)for(n=0,c=s[l];n<a;++n)if((i=r[n]).type===c.type&&i.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?rt:it)(t,e))}};var lt=0;function ut(){this._="@"+(++lt).toString(36)}function ht(){for(var t,e=K;t=e.sourceEvent;)e=t;return e}function dt(t,e){var o=t.ownerSVGElement||t;if(o.createSVGPoint){var n=o.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}function pt(t){var e=ht();return e.changedTouches&&(e=e.changedTouches[0]),dt(t,e)}function ft(t,e,o){arguments.length<3&&(o=e,e=ht().changedTouches);for(var n,i=0,r=e?e.length:0;i<r;++i)if((n=e[i]).identifier===o)return dt(t,n);return null}ut.prototype=function(){return new ut}.prototype={constructor:ut,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var yt={value:function(){}};function gt(){for(var t,e=0,o=arguments.length,n={};e<o;++e){if(!(t=arguments[e]+"")||t in n)throw new Error("illegal type: "+t);n[t]=[]}return new _t(n)}function _t(t){this._=t}function mt(t,e){for(var o,n=0,i=t.length;n<i;++n)if((o=t[n]).name===e)return o.value}function xt(t,e,o){for(var n=0,i=t.length;n<i;++n)if(t[n].name===e){t[n]=yt,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=o&&t.push({name:e,value:o}),t}_t.prototype=gt.prototype={constructor:_t,on:function(t,e){var o,n,i=this._,r=(n=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",o=t.indexOf(".");if(o>=0&&(e=t.slice(o+1),t=t.slice(0,o)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,s=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(o=(t=r[a]).type)i[o]=xt(i[o],t.name,e);else if(null==e)for(o in i)i[o]=xt(i[o],t.name,null);return this}for(;++a<s;)if((o=(t=r[a]).type)&&(o=mt(i[o],t.name)))return o},copy:function(){var t={},e=this._;for(var o in e)t[o]=e[o].slice();return new _t(t)},call:function(t,e){if((o=arguments.length-2)>0)for(var o,n,i=new Array(o),r=0;r<o;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,o=(n=this._[t]).length;r<o;++r)n[r].value.apply(e,i)},apply:function(t,e,o){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],i=0,r=n.length;i<r;++i)n[i].value.apply(e,o)}};const vt=gt;function Ot(){K.stopImmediatePropagation()}function wt(){K.preventDefault(),K.stopImmediatePropagation()}function bt(t){return function(){return t}}function St(t,e,o,n,i,r,a,s,c,l){this.target=t,this.type=e,this.subject=o,this.identifier=n,this.active=i,this.x=r,this.y=a,this.dx=s,this.dy=c,this._=l}function kt(){return!K.button}function Et(){return this.parentNode}function Rt(t){return null==t?{x:K.x,y:K.y}:t}function Tt(){return"ontouchstart"in this}function Nt(){var t,e,o,n,i=kt,r=Et,a=Rt,s=Tt,c={},l=vt("start","drag","end"),u=0,h=0;function d(t){t.on("mousedown.drag",p).filter(s).on("touchstart.drag",g).on("touchmove.drag",_).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(){if(!n&&i.apply(this,arguments)){var a=x("mouse",r.apply(this,arguments),pt,this,arguments);a&&(ct(K.view).on("mousemove.drag",f,!0).on("mouseup.drag",y,!0),function(t){var e=t.document.documentElement,o=ct(t).on("dragstart.drag",wt,!0);"onselectstart"in e?o.on("selectstart.drag",wt,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(K.view),Ot(),o=!1,t=K.clientX,e=K.clientY,a("start"))}}function f(){if(wt(),!o){var n=K.clientX-t,i=K.clientY-e;o=n*n+i*i>h}c.mouse("drag")}function y(){ct(K.view).on("mousemove.drag mouseup.drag",null),function(t,e){var o=t.document.documentElement,n=ct(t).on("dragstart.drag",null);e&&(n.on("click.drag",wt,!0),setTimeout((function(){n.on("click.drag",null)}),0)),"onselectstart"in o?n.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}(K.view,o),wt(),c.mouse("end")}function g(){if(i.apply(this,arguments)){var t,e,o=K.changedTouches,n=r.apply(this,arguments),a=o.length;for(t=0;t<a;++t)(e=x(o[t].identifier,n,ft,this,arguments))&&(Ot(),e("start"))}}function _(){var t,e,o=K.changedTouches,n=o.length;for(t=0;t<n;++t)(e=c[o[t].identifier])&&(wt(),e("drag"))}function m(){var t,e,o=K.changedTouches,i=o.length;for(n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),t=0;t<i;++t)(e=c[o[t].identifier])&&(Ot(),e("end"))}function x(t,e,o,n,i){var r,s,h,p=o(e,t),f=l.copy();if(ot(new St(d,"beforestart",r,t,u,p[0],p[1],0,0,f),(function(){return null!=(K.subject=r=a.apply(n,i))&&(s=r.x-p[0]||0,h=r.y-p[1]||0,!0)})))return function a(l){var y,g=p;switch(l){case"start":c[t]=a,y=u++;break;case"end":delete c[t],--u;case"drag":p=o(e,t),y=u}ot(new St(d,l,r,t,y,p[0]+s,p[1]+h,p[0]-g[0],p[1]-g[1],f),f.apply,f,[l,n,i])}}return d.filter=function(t){return arguments.length?(i="function"==typeof t?t:bt(!!t),d):i},d.container=function(t){return arguments.length?(r="function"==typeof t?t:bt(t),d):r},d.subject=function(t){return arguments.length?(a="function"==typeof t?t:bt(t),d):a},d.touchable=function(t){return arguments.length?(s="function"==typeof t?t:bt(!!t),d):s},d.on=function(){var t=l.on.apply(l,arguments);return t===l?d:t},d.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,d):Math.sqrt(h)},d}St.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Pt=Math.PI,At=2*Pt,Gt=1e-6,Dt=At-Gt;function Vt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Ct(){return new Vt}Vt.prototype=Ct.prototype={constructor:Vt,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,o,n){this._+="Q"+ +t+","+ +e+","+(this._x1=+o)+","+(this._y1=+n)},bezierCurveTo:function(t,e,o,n,i,r){this._+="C"+ +t+","+ +e+","+ +o+","+ +n+","+(this._x1=+i)+","+(this._y1=+r)},arcTo:function(t,e,o,n,i){t=+t,e=+e,o=+o,n=+n,i=+i;var r=this._x1,a=this._y1,s=o-t,c=n-e,l=r-t,u=a-e,h=l*l+u*u;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>Gt)if(Math.abs(u*s-c*l)>Gt&&i){var d=o-r,p=n-a,f=s*s+c*c,y=d*d+p*p,g=Math.sqrt(f),_=Math.sqrt(h),m=i*Math.tan((Pt-Math.acos((f+h-y)/(2*g*_)))/2),x=m/_,v=m/g;Math.abs(x-1)>Gt&&(this._+="L"+(t+x*l)+","+(e+x*u)),this._+="A"+i+","+i+",0,0,"+ +(u*d>l*p)+","+(this._x1=t+v*s)+","+(this._y1=e+v*c)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,o,n,i,r){t=+t,e=+e,r=!!r;var a=(o=+o)*Math.cos(n),s=o*Math.sin(n),c=t+a,l=e+s,u=1^r,h=r?n-i:i-n;if(o<0)throw new Error("negative radius: "+o);null===this._x1?this._+="M"+c+","+l:(Math.abs(this._x1-c)>Gt||Math.abs(this._y1-l)>Gt)&&(this._+="L"+c+","+l),o&&(h<0&&(h=h%At+At),h>Dt?this._+="A"+o+","+o+",0,1,"+u+","+(t-a)+","+(e-s)+"A"+o+","+o+",0,1,"+u+","+(this._x1=c)+","+(this._y1=l):h>Gt&&(this._+="A"+o+","+o+",0,"+ +(h>=Pt)+","+u+","+(this._x1=t+o*Math.cos(i))+","+(this._y1=e+o*Math.sin(i))))},rect:function(t,e,o,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +o+"v"+ +n+"h"+-o+"Z"},toString:function(){return this._}};const Mt=Ct;function It(t){return function(){return t}}var Lt=1e-12,jt=Math.PI,Ut=jt/2,zt=2*jt;function $t(t){return t.innerRadius}function Bt(t){return t.outerRadius}function Ft(t){return t.startAngle}function Yt(t){return t.endAngle}function Ht(t){return t&&t.padAngle}function qt(t){return t>=1?Ut:t<=-1?-Ut:Math.asin(t)}function Wt(t,e,o,n,i,r,a){var s=t-o,c=e-n,l=(a?r:-r)/Math.sqrt(s*s+c*c),u=l*c,h=-l*s,d=t+u,p=e+h,f=o+u,y=n+h,g=(d+f)/2,_=(p+y)/2,m=f-d,x=y-p,v=m*m+x*x,O=i-r,w=d*y-f*p,b=(x<0?-1:1)*Math.sqrt(Math.max(0,O*O*v-w*w)),S=(w*x-m*b)/v,k=(-w*m-x*b)/v,E=(w*x+m*b)/v,R=(-w*m+x*b)/v,T=S-g,N=k-_,P=E-g,A=R-_;return T*T+N*N>P*P+A*A&&(S=E,k=R),{cx:S,cy:k,x01:-u,y01:-h,x11:S*(i/O-1),y11:k*(i/O-1)}}function Xt(t){this._context=t}function Jt(t){return new Xt(t)}function Kt(t){return t[0]}function Zt(t){return t[1]}function Qt(t){this._curve=t}Xt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},Qt.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}},Math.sqrt(1/3);Math.sin(jt/10),Math.sin(7*jt/10);function te(){}function ee(t,e,o){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+o)/6)}function oe(t){this._context=t}function ne(t,e){this._basis=new oe(t),this._beta=e}function ie(t,e,o){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-o),t._x2,t._y2)}function re(t,e){this._context=t,this._k=(1-e)/6}function ae(t,e){this._context=t,this._k=(1-e)/6}function se(t,e){this._context=t,this._k=(1-e)/6}function ce(t,e,o){var n=t._x1,i=t._y1,r=t._x2,a=t._y2;if(t._l01_a>Lt){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);n=(n*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,i=(i*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>Lt){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);r=(r*l+t._x1*t._l23_2a-e*t._l12_2a)/u,a=(a*l+t._y1*t._l23_2a-o*t._l12_2a)/u}t._context.bezierCurveTo(n,i,r,a,t._x2,t._y2)}function le(t,e){this._context=t,this._alpha=e}Math.sin(zt/10),Math.cos(zt/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),oe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ee(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ee(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},ne.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,o=t.length-1;if(o>0)for(var n,i=t[0],r=e[0],a=t[o]-i,s=e[o]-r,c=-1;++c<=o;)n=c/o,this._basis.point(this._beta*t[c]+(1-this._beta)*(i+n*a),this._beta*e[c]+(1-this._beta)*(r+n*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}},function t(e){function o(t){return 1===e?new oe(t):new ne(t,e)}return o.beta=function(e){return t(+e)},o}(.85),re.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ie(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:ie(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function o(t){return new re(t,e)}return o.tension=function(e){return t(+e)},o}(0),ae.prototype={areaStart:te,areaEnd:te,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:ie(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function o(t){return new ae(t,e)}return o.tension=function(e){return t(+e)},o}(0),se.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ie(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function o(t){return new se(t,e)}return o.tension=function(e){return t(+e)},o}(0),le.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var o=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(o*o+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:ce(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ue=function t(e){function o(t){return e?new le(t,e):new re(t,0)}return o.alpha=function(e){return t(+e)},o}(.5);function he(t,e){this._context=t,this._alpha=e}function de(t,e){this._context=t,this._alpha=e}function pe(t){return t<0?-1:1}function fe(t,e,o){var n=t._x1-t._x0,i=e-t._x1,r=(t._y1-t._y0)/(n||i<0&&-0),a=(o-t._y1)/(i||n<0&&-0),s=(r*i+a*n)/(n+i);return(pe(r)+pe(a))*Math.min(Math.abs(r),Math.abs(a),.5*Math.abs(s))||0}function ye(t,e){var o=t._x1-t._x0;return o?(3*(t._y1-t._y0)/o-e)/2:e}function ge(t,e,o){var n=t._x0,i=t._y0,r=t._x1,a=t._y1,s=(r-n)/3;t._context.bezierCurveTo(n+s,i+s*e,r-s,a-s*o,r,a)}function _e(t){this._context=t}function me(t){this._context=t}he.prototype={areaStart:te,areaEnd:te,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var o=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(o*o+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:ce(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function o(t){return e?new he(t,e):new ae(t,0)}return o.alpha=function(e){return t(+e)},o}(.5),de.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var o=this._x2-t,n=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(o*o+n*n,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ce(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function o(t){return e?new de(t,e):new se(t,0)}return o.alpha=function(e){return t(+e)},o}(.5),_e.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ge(this,this._t0,ye(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var o=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,ge(this,ye(this,o=fe(this,t,e)),o);break;default:ge(this,this._t0,o=fe(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=o}}},(function(t){this._context=new me(t)}.prototype=Object.create(_e.prototype)).point=function(t,e){_e.prototype.point.call(this,e,t)},me.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,o,n,i,r){this._context.bezierCurveTo(e,t,n,o,r,i)}},Array.prototype.slice;var xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Oe=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),we=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},be=function t(e,o,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,o);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,o,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},Se=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},ke=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Ee=function(){function t(e){var o=e.x,n=void 0===o?0:o,i=e.y,r=void 0===i?0:i,a=e.nx,s=e.ny,c=e.dy,l=void 0===c?0:c,u=e.dx,h=void 0===u?0:u,d=e.color,p=void 0===d?"grey":d,f=e.data,y=e.type,g=e.subject,_=e.connector,m=e.note,x=e.disable,v=e.id,O=e.className;ve(this,t),this._dx=void 0!==a?a-n:h,this._dy=void 0!==s?s-r:l,this._x=n,this._y=r,this._color=p,this.id=v,this._className=O||"",this._type=y||"",this.data=f,this.note=m||{},this.connector=_||{},this.subject=g||{},this.disable=x||[]}return Oe(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"clearComponents",value:function(){this.type.clearComponents&&this.type.clearComponents()}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this.clearComponents()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var e=t.x,o=t.y;this._dx=e,this._dy=o,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var e=t.x,o=t.y;this._x=e,this._y=o,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),Re=function(){function t(e){var o=e.annotations,n=e.accessors,i=e.accessorsInverse;ve(this,t),this.accessors=n,this.accessorsInverse=i,this.annotations=o}return Oe(t,[{key:"clearTypes",value:function(t){this.annotations.forEach((function(e){e.type=void 0,e.subject=t&&t.subject||e.subject,e.connector=t&&t.connector||e.connector,e.note=t&&t.note||e.note}))}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach((function(e){e.type.setPositionWithAccessors(t.accessors)}))}},{key:"editMode",value:function(t){this.annotations.forEach((function(e){e.type&&(e.type.editMode=t,e.type.updateEditMode())}))}},{key:"updateDisable",value:function(t){this.annotations.forEach((function(e){e.disable=t,e.type&&t.forEach((function(t){e.type[t]&&(e.type[t].remove&&e.type[t].remove(),e.type[t]=void 0)}))}))}},{key:"updateTextWrap",value:function(t){this.annotations.forEach((function(e){e.type&&e.type.updateTextWrap&&e.type.updateTextWrap(t)}))}},{key:"updateText",value:function(){this.annotations.forEach((function(t){t.type&&t.type.drawText&&t.type.drawText()}))}},{key:"updateNotePadding",value:function(t){this.annotations.forEach((function(e){e.type&&(e.type.notePadding=t)}))}},{key:"json",get:function(){var t=this;return this.annotations.map((function(e){var o=e.json;return t.accessorsInverse&&e.data&&(o.data={},Object.keys(t.accessorsInverse).forEach((function(n){o.data[n]=t.accessorsInverse[n]({x:e.x,y:e.y})}))),o}))}},{key:"noteNodes",get:function(){return this.annotations.map((function(t){return we({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})}))}}]),t}(),Te=function(t,e){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=e<0?"top":"bottom"),t},Ne=function(t,e){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=e<0?"right":"left"),t},Pe=["topBottom","top","bottom"],Ae=["leftRight","left","right"],Ge=function(t){var e=t.data,o=t.curve,n=void 0===o?Jt:o,i=t.canvasContext,r=t.className,a=t.classID,s=function(){var t=Kt,e=Zt,o=It(!0),n=null,i=Jt,r=null;function a(a){var s,c,l,u=a.length,h=!1;for(null==n&&(r=i(l=Mt())),s=0;s<=u;++s)!(s<u&&o(c=a[s],s,a))===h&&((h=!h)?r.lineStart():r.lineEnd()),h&&r.point(+t(c,s,a),+e(c,s,a));if(l)return r=null,l+""||null}return a.x=function(e){return arguments.length?(t="function"==typeof e?e:It(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:It(+t),a):e},a.defined=function(t){return arguments.length?(o="function"==typeof t?t:It(!!t),a):o},a.curve=function(t){return arguments.length?(i=t,null!=n&&(r=i(n)),a):i},a.context=function(t){return arguments.length?(null==t?n=r=null:r=i(n=t),a):n},a}().curve(n),c={type:"path",className:r,classID:a,data:e};return i?(s.context(i),c.pathMethods=s):c.attrs={d:s(e)},c},De=function(t){var e=t.data,o=t.canvasContext,n={type:"path",className:t.className,classID:t.classID,data:e},i=function(){var t=$t,e=Bt,o=It(0),n=null,i=Ft,r=Yt,a=Ht,s=null;function c(){var c,l,u=+t.apply(this,arguments),h=+e.apply(this,arguments),d=i.apply(this,arguments)-Ut,p=r.apply(this,arguments)-Ut,f=Math.abs(p-d),y=p>d;if(s||(s=c=Mt()),h<u&&(l=h,h=u,u=l),h>Lt)if(f>zt-Lt)s.moveTo(h*Math.cos(d),h*Math.sin(d)),s.arc(0,0,h,d,p,!y),u>Lt&&(s.moveTo(u*Math.cos(p),u*Math.sin(p)),s.arc(0,0,u,p,d,y));else{var g,_,m=d,x=p,v=d,O=p,w=f,b=f,S=a.apply(this,arguments)/2,k=S>Lt&&(n?+n.apply(this,arguments):Math.sqrt(u*u+h*h)),E=Math.min(Math.abs(h-u)/2,+o.apply(this,arguments)),R=E,T=E;if(k>Lt){var N=qt(k/u*Math.sin(S)),P=qt(k/h*Math.sin(S));(w-=2*N)>Lt?(v+=N*=y?1:-1,O-=N):(w=0,v=O=(d+p)/2),(b-=2*P)>Lt?(m+=P*=y?1:-1,x-=P):(b=0,m=x=(d+p)/2)}var A=h*Math.cos(m),G=h*Math.sin(m),D=u*Math.cos(O),V=u*Math.sin(O);if(E>Lt){var C=h*Math.cos(x),M=h*Math.sin(x),I=u*Math.cos(v),L=u*Math.sin(v);if(f<jt){var j=w>Lt?function(t,e,o,n,i,r,a,s){var c=o-t,l=n-e,u=a-i,h=s-r,d=(u*(e-r)-h*(t-i))/(h*c-u*l);return[t+d*c,e+d*l]}(A,G,I,L,C,M,D,V):[D,V],U=A-j[0],z=G-j[1],$=C-j[0],B=M-j[1],F=1/Math.sin(Math.acos((U*$+z*B)/(Math.sqrt(U*U+z*z)*Math.sqrt($*$+B*B)))/2),Y=Math.sqrt(j[0]*j[0]+j[1]*j[1]);R=Math.min(E,(u-Y)/(F-1)),T=Math.min(E,(h-Y)/(F+1))}}b>Lt?T>Lt?(g=Wt(I,L,A,G,h,T,y),_=Wt(C,M,D,V,h,T,y),s.moveTo(g.cx+g.x01,g.cy+g.y01),T<E?s.arc(g.cx,g.cy,T,Math.atan2(g.y01,g.x01),Math.atan2(_.y01,_.x01),!y):(s.arc(g.cx,g.cy,T,Math.atan2(g.y01,g.x01),Math.atan2(g.y11,g.x11),!y),s.arc(0,0,h,Math.atan2(g.cy+g.y11,g.cx+g.x11),Math.atan2(_.cy+_.y11,_.cx+_.x11),!y),s.arc(_.cx,_.cy,T,Math.atan2(_.y11,_.x11),Math.atan2(_.y01,_.x01),!y))):(s.moveTo(A,G),s.arc(0,0,h,m,x,!y)):s.moveTo(A,G),u>Lt&&w>Lt?R>Lt?(g=Wt(D,V,C,M,u,-R,y),_=Wt(A,G,I,L,u,-R,y),s.lineTo(g.cx+g.x01,g.cy+g.y01),R<E?s.arc(g.cx,g.cy,R,Math.atan2(g.y01,g.x01),Math.atan2(_.y01,_.x01),!y):(s.arc(g.cx,g.cy,R,Math.atan2(g.y01,g.x01),Math.atan2(g.y11,g.x11),!y),s.arc(0,0,u,Math.atan2(g.cy+g.y11,g.cx+g.x11),Math.atan2(_.cy+_.y11,_.cx+_.x11),y),s.arc(_.cx,_.cy,R,Math.atan2(_.y11,_.x11),Math.atan2(_.y01,_.x01),!y))):s.arc(0,0,u,O,v,y):s.lineTo(D,V)}else s.moveTo(0,0);if(s.closePath(),c)return s=null,c+""||null}return c.centroid=function(){var o=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,n=(+i.apply(this,arguments)+ +r.apply(this,arguments))/2-jt/2;return[Math.cos(n)*o,Math.sin(n)*o]},c.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:It(+e),c):t},c.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:It(+t),c):e},c.cornerRadius=function(t){return arguments.length?(o="function"==typeof t?t:It(+t),c):o},c.padRadius=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:It(+t),c):n},c.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:It(+t),c):i},c.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:It(+t),c):r},c.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:It(+t),c):a},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}().innerRadius(e.innerRadius||0).outerRadius(e.outerRadius||e.radius||2).startAngle(e.startAngle||0).endAngle(e.endAngle||2*Math.PI);return o?(i.context(o),n.pathMethods=lineGen):n.attrs={d:i()},n},Ve=function(t){var e=t.type,o=t.subjectType,n=e.annotation,i=n.position,r=n.x-i.x,a=r+n.dx,s=n.y-i.y,c=s+n.dy,l=n.subject;if("circle"===o&&(l.outerRadius||l.radius)){var u=Math.sqrt((r-a)*(r-a)+(s-c)*(s-c)),h=Math.asin(-c/u),d=l.outerRadius||l.radius+(l.radiusPadding||0);r=Math.abs(Math.cos(h)*d)*(a<0?-1:1),s=Math.abs(Math.sin(h)*d)*(c<0?-1:1)}if("rect"===o){var p=l.width,f=l.height;(p>0&&n.dx>0||p<0&&n.dx<0)&&(r=Math.abs(p)>Math.abs(n.dx)?p/2:p),(f>0&&n.dy>0||f<0&&n.dy<0)&&(s=Math.abs(f)>Math.abs(n.dy)?f/2:f),r===p/2&&s===f/2&&(r=a,s=c)}return[[r,s],[a,c]]},Ce=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=t.x/(e+1),n=t.y/(e+1),i=[],r=1;r<=e;r++)i.push([o*r+r%2*20,n*r-r%2*20]);return i},Me=function(){function t(e){var o=e.a,n=e.annotation,i=e.editMode,r=e.dispatcher,a=e.notePadding,s=e.accessors;if(ve(this,t),this.a=o,this.note=-1===n.disable.indexOf("note")&&o.select("g.annotation-note"),this.noteContent=this.note&&o.select("g.annotation-note-content"),this.connector=-1===n.disable.indexOf("connector")&&o.select("g.annotation-connector"),this.subject=-1===n.disable.indexOf("subject")&&o.select("g.annotation-subject"),this.dispatcher=r,r){var c=Xe.bind(null,r,n);c({component:this.note,name:"note"}),c({component:this.connector,name:"connector"}),c({component:this.subject,name:"subject"})}this.annotation=n,this.editMode=n.editMode||i,this.notePadding=void 0!==a?a:3,this.offsetCornerX=0,this.offsetCornerY=0,s&&n.data&&this.init(s)}return Oe(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,e){var o=this;Array.isArray(e)||(e=[e]),e.filter((function(t){return t})).forEach((function(e){var n=e.type,i=e.className,r=e.attrs,a=e.handles,s=e.classID;if("handle"===n)!function(t){var e=t.group,o=t.handles,n=t.r,i=void 0===n?10:n,r=e.selectAll("circle.handle").data(o);r.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(Nt().container(ct("g.annotations").node()).on("start",(function(t){return t.start&&t.start(t)})).on("drag",(function(t){return t.drag&&t.drag(t)})).on("end",(function(t){return t.end&&t.end(t)}))),e.selectAll("circle.handle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",(function(t){return t.r||i})).attr("class",(function(t){return"handle "+(t.className||"")})),r.exit().remove()}({group:t,r:r&&r.r,handles:a});else{We(t,[o.annotation],n,i,s);for(var c=t.select(n+"."+(s||i)),l=Object.keys(r),u=[],h=c.node().attributes,d=h.length-1;d>=0;d--){var p=h[d].name;-1===l.indexOf(p)&&"class"!==p&&u.push(p)}l.forEach((function(t){"text"===t?c.text(r[t]):c.attr(t,r[t])})),u.forEach((function(t){return c.attr(t,null)}))}}))}},{key:"getNoteBBox",value:function(){return Ke(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=Ke(this.note,".annotation-note-content"),e=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(e[1])+this.annotation.dx,t.offsetCornerY=parseFloat(e[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.annotation.subject,n=e.type,i={type:this,subjectData:o},r={};"circle"===n?r=function(t){var e=t.subjectData,o=t.type;e.radius||e.outerRadius||(e.radius=20);var n=[],i=De({data:e,className:"subject"});if(o.editMode){var r=function(t){var e=t.cx,o=void 0===e?0:e,n=t.cy,i=void 0===n?0:n,r=t.r1,a=t.r2,s=t.padding,c={move:{x:o,y:i}};return void 0!==r&&(c.r1={x:o+r/Math.sqrt(2),y:i+r/Math.sqrt(2)}),void 0!==a&&(c.r2={x:o+a/Math.sqrt(2),y:i+a/Math.sqrt(2)}),void 0!==s&&(c.padding={x:o+r+s,y:i}),c}({r1:i.data.outerRadius||i.data.radius,r2:i.data.innerRadius,padding:e.radiusPadding}),a=function(t){var n=e[t]+K.dx*Math.sqrt(2);e[t]=n,o.redrawSubject(),o.redrawConnector()},s=[we({},r.r1,{drag:a.bind(o,void 0!==e.outerRadius?"outerRadius":"radius")})];e.innerRadius&&s.push(we({},r.r2,{drag:a.bind(o,"innerRadius")})),n=o.mapHandles(s)}return i.attrs["fill-opacity"]=0,{components:[i],handles:n}}(i):"rect"===n?r=function(t){var e=t.subjectData,o=t.type;e.width||(e.width=100),e.height||(e.height=100);var n=[],i=e.width,r=e.height,a=Ge({data:[[0,0],[i,0],[i,r],[0,r],[0,0]],className:"subject"});if(o.editMode){var s=[{x:i,y:r/2,drag:function(){e.width=K.x,o.redrawSubject(),o.redrawConnector()}.bind(o)},{x:i/2,y:r,drag:function(){e.height=K.y,o.redrawSubject(),o.redrawConnector()}.bind(o)}];n=o.mapHandles(s)}return a.attrs["fill-opacity"]=.1,{components:[a],handles:n}}(i):"threshold"===n?r=function(t){var e=t.subjectData,o=t.type.annotation.position,n=(void 0!==e.x1?e.x1:o.x)-o.x,i=(void 0!==e.x2?e.x2:o.x)-o.x,r=(void 0!==e.y1?e.y1:o.y)-o.y,a=(void 0!==e.y2?e.y2:o.y)-o.y;return{components:[Ge({data:[[n,r],[i,a]],className:"subject"})]}}(i):"badge"===n&&(r=function(t){var e=t.subjectData,o=void 0===e?{}:e,n=t.type,i=void 0===n?{}:n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.typeSettings&&i.typeSettings.subject;o.radius||(a&&a.radius?o.radius=a.radius:o.radius=14),o.x||a&&a.x&&(o.x=a.x),o.y||a&&a.y&&(o.y=a.y);var s=[],c=[],l=o.radius,u=.7*l,h=0,d=0,p=Math.sqrt(2)*l,f={xleftcorner:-l,xrightcorner:l,ytopcorner:-l,ybottomcorner:l,xleft:-p,xright:p,ytop:-p,ybottom:p};o.x&&!o.y?h=f["x"+o.x]:o.y&&!o.x?d=f["y"+o.y]:o.x&&o.y&&(h=f["x"+o.x+"corner"],d=f["y"+o.y+"corner"]);var y="translate("+h+", "+d+")",g=De({className:"subject",data:{radius:l}});g.attrs.transform=y,g.attrs.fill=r.color,g.attrs["stroke-linecap"]="round",g.attrs["stroke-width"]="3px";var _=De({className:"subject-ring",data:{outerRadius:l,innerRadius:u}});_.attrs.transform=y,_.attrs["stroke-width"]="3px",_.attrs.fill="white";var m=void 0;if(h&&d||!h&&!d)m=Ge({className:"subject-pointer",data:[[0,0],[h||0,0],[0,d||0],[0,0]]});else if(h||d){var x=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||e*l/Math.sqrt(2)};m=Ge({className:"subject-pointer",data:[[0,0],[x(h),x(d)],[x(h,-1),x(d,-1)],[0,0]]})}if(m&&(m.attrs.fill=r.color,m.attrs["stroke-linecap"]="round",m.attrs["stroke-width"]="3px",c.push(m)),i.editMode){var v={x:2*h,y:2*d,drag:function(){o.x=K.x<2*-l?"left":K.x>2*l?"right":void 0,o.y=K.y<2*-l?"top":K.y>2*l?"bottom":void 0,i.redrawSubject()}.bind(i)};v.x||v.y||(v.y=-l),s=i.mapHandles([v])}var O=void 0;return o.text&&(O={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:o.text,"text-anchor":"middle",dy:".25em",x:h,y:d}}),c.push(g),c.push(_),c.push(O),{components:c,handles:s}}(i,this.annotation));var a=r,s=a.components,c=void 0===s?[]:s,l=a.handles,u=void 0===l?[]:l;return c.forEach((function(e){e&&e.attrs&&!e.attrs.stroke&&(e.attrs.stroke=t.annotation.color)})),this.editMode&&(u=u.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),c.push({type:"handle",handles:u})),c}},{key:"drawConnector",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.annotation.connector,n=o.type||e.type,i={type:this,connectorData:o};i.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var r;r="curve"===n?function(t){var e=t.type,o=t.connectorData,n=t.subjectType;o||(o={}),o.points&&"number"!=typeof o.points||(o.points=Ce(e.annotation.offset,o.points)),o.curve||(o.curve=ue);var i=[];if(e.editMode){var r=o.points.map((function(t,e){return we({},function(t){var e=t.cx,o=t.cy;return{move:{x:void 0===e?0:e,y:void 0===o?0:o}}}({cx:t[0],cy:t[1]}),{index:e})})),a=function(t){o.points[t][0]+=K.dx,o.points[t][1]+=K.dy,e.redrawConnector()};i=e.mapHandles(r.map((function(t){return we({},t.move,{drag:a.bind(e,t.index)})})))}var s=Ve({type:e,subjectType:n});return s=[s[0]].concat(function(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}(o.points),[s[1]]),{components:[Ge({data:s,curve:o.curve,className:"connector"})],handles:i}}(i):"elbow"===n?function(t){var e=t.type,o=t.subjectType,n=e.annotation,i=n.position,r=n.x-i.x,a=r+n.dx,s=n.y-i.y,c=s+n.dy,l=n.subject;if("rect"===o){var u=l.width,h=l.height;(u>0&&n.dx>0||u<0&&n.dx<0)&&(r=Math.abs(u)>Math.abs(n.dx)?u/2:u),(h>0&&n.dy>0||h<0&&n.dy<0)&&(s=Math.abs(h)>Math.abs(n.dy)?h/2:h),r===u/2&&s===h/2&&(r=a,s=c)}var d=[[r,s],[a,c]],p=c-s,f=a-r,y=a,g=c,_=c<s&&a>r||a<r&&c>s?-1:1;if(Math.abs(f)<Math.abs(p)?(y=a,g=s+f*_):(g=c,y=r+p*_),"circle"===o&&(l.outerRadius||l.radius)){var m=(l.outerRadius||l.radius)+(l.radiusPadding||0),x=m/Math.sqrt(2);if(Math.abs(f)>x&&Math.abs(p)>x)d=[[r=x*(a<0?-1:1),s=x*(c<0?-1:1)],[y,g],[a,c]];else if(Math.abs(f)>Math.abs(p)){var v=Math.asin(-c/m);d=[[r=Math.abs(Math.cos(v)*m)*(a<0?-1:1),c],[a,c]]}else{var O=Math.acos(a/m);d=[[a,s=Math.abs(Math.sin(O)*m)*(c<0?-1:1)],[a,c]]}}else d=[[r,s],[y,g],[a,c]];return{components:[Ge({data:d,className:"connector"})]}}(i):function(t){var e=Ve(t);return{components:[Ge({data:e,className:"connector"})]}}(i);var a=r,s=a.components,c=void 0===s?[]:s,l=a.handles,u=void 0===l?[]:l,h=c[0];h&&(h.attrs.stroke=this.annotation.color,h.attrs.fill="none");var d=o.end||e.end,p={};if("arrow"===d){var f=h.data[1],y=h.data[0];Math.sqrt(Math.pow(f[0]-y[0],2)+Math.pow(f[1]-y[1],2))<5&&h.data[2]&&(f=h.data[2]),p=function(t){var e=t.annotation,o=t.start,n=t.end,i=t.scale,r=void 0===i?1:i,a=e.position;o=o?[-n[0]+o[0],-n[1]+o[1]]:[e.dx,e.dy],n||(n=[e.x-a.x,e.y-a.y]);var s=n[0],c=n[1],l=o[0],u=o[1],h=10*r,d=16/180*Math.PI,p=Math.atan(u/l);l<0&&(p+=Math.PI);var f=[[s,c],[Math.cos(p+d)*h+s,Math.sin(p+d)*h+c],[Math.cos(p-d)*h+s,Math.sin(p-d)*h+c],[s,c]];return{components:[Ge({data:f,className:"connector-end connector-arrow",classID:"connector-end"})]}}({annotation:this.annotation,start:f,end:y,scale:o.endScale})}else"dot"===d?p=function(t){var e=t.line,o=t.scale,n=void 0===o?1:o,i=De({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(n)}});return i.attrs.transform="translate("+e.data[0][0]+", "+e.data[0][1]+")",{components:[i]}}({line:h,scale:o.endScale}):d&&"none"!==d||this.connector&&this.connector.select(".connector-end").remove();return p.components&&(p.components.forEach((function(e){e.attrs.fill=t.annotation.color,e.attrs.stroke=t.annotation.color})),c=c.concat(p.components)),this.editMode&&0!==u.length&&c.push({type:"handle",handles:u}),c}},{key:"drawNote",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.annotation.note,n=o.align||e.align||"dynamic",i={bbox:e.bbox,align:n,offset:this.annotation.offset},r=o.lineType||e.lineType,a={};"vertical"===r?a=function(t){var e=t.align,o=t.x,n=void 0===o?0:o,i=t.y,r=void 0===i?0:i,a=t.bbox;"top"===(e=Te(e,t.offset.y))?r-=a.height:"middle"===e&&(r-=a.height/2);var s=[[n,r],[n,r+a.height]];return{components:[Ge({data:s,className:"note-line"})]}}(i):"horizontal"===r&&(a=function(t){var e=t.align,o=t.x,n=void 0===o?0:o,i=t.y,r=void 0===i?0:i,a=t.bbox;"right"===(e=Ne(e,t.offset.x))?n-=a.width:"middle"===e&&(n-=a.width/2);var s=[[n,r],[n+a.width,r]];return{components:[Ge({data:s,className:"note-line"})]}}(i));var s=a,c=s.components,l=void 0===c?[]:c,u=s.handles,h=void 0===u?[]:u;if(l.forEach((function(e){e.attrs.stroke=t.annotation.color})),this.editMode){h=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),l.push({type:"handle",handles:h});var d=this.dragNote.bind(this),p=this.dragstarted.bind(this),f=this.dragended.bind(this);this.note.call(Nt().container(ct("g.annotations").node()).on("start",(function(t){return p(t)})).on("drag",(function(t){return d(t)})).on("end",(function(t){return f(t)})))}else this.note.on("mousedown.drag",null);return l}},{key:"drawNoteContent",value:function(t){var e=this.annotation.note,o=void 0!==e.padding?e.padding:this.notePadding,n=e.orientation||t.orientation||"topBottom",i=e.lineType||t.lineType,r=e.align||t.align||"dynamic";"vertical"===i?n="leftRight":"horizontal"===i&&(n="topBottom");var a=function(t){var e=t.padding,o=void 0===e?0:e,n=t.bbox,i=void 0===n?{x:0,y:0,width:0,height:0}:n,r=t.align,a=t.orientation,s=t.offset,c=void 0===s?{x:0,y:0}:s,l=-i.x,u=0;return-1!==Pe.indexOf(a)?(r=Ne(r,c.x),c.y<0&&"topBottom"===a||"top"===a?u-=i.height+o:u+=o,"middle"===r?l-=i.width/2:"right"===r&&(l-=i.width)):-1!==Ae.indexOf(a)&&(r=Te(r,c.y),c.x<0&&"leftRight"===a||"left"===a?l-=i.width+o:l+=o,"middle"===r?u-=i.height/2:"top"===r&&(u-=i.height)),{x:l,y:u}}({padding:o,bbox:t.bbox,offset:this.annotation.offset,orientation:n,align:r}),s=a.x,c=a.y;return this.offsetCornerX=s+this.annotation.dx,this.offsetCornerY=c+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+s+", "+c+")"),[]}},{key:"drawOnScreen",value:function(t,e){return this.drawOnSVG(t,e)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"clearComponents",value:function(){this.subject&&this.subject.select("*").remove(),this.connector&&this.connector.select("*").remove()}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){K.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=K.dx,t.y+=K.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=K.dx,t.y+=K.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var e=this;return t.map((function(t){return we({},t,{start:e.dragstarted.bind(e),end:e.dragended.bind(e)})}))}}]),t}(),Ie=function(t,e,o){return function(t){function n(t){ve(this,n);var o=ke(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return o.typeSettings=e,e.disable&&e.disable.forEach((function(t){o[t]&&o[t].remove(),o[t]=void 0,"note"===t&&(o.noteContent=void 0)})),o}return Se(n,t),Oe(n,[{key:"className",value:function(){return""+(e.className||be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"className",this)&&be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=we({},e.subject,this.typeSettings.subject),be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"drawSubject",this).call(this,we({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=we({},e.connector,this.typeSettings.connector),be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"drawConnector",this).call(this,we({},t,e.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=we({},e.note,this.typeSettings.note),be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"drawNote",this).call(this,we({},t,e.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return be(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"drawNoteContent",this).call(this,we({},t,e.note,this.typeSettings.note))}}],[{key:"init",value:function(t,e){return be(n.__proto__||Object.getPrototypeOf(n),"init",this).call(this,t,e),o&&(t=o(t,e)),t}}]),n}(t)},Le=function(t){function e(t){ve(this,e);var o=ke(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o.textWrap=t.textWrap||120,o.drawText(),o}return Se(e,t),Oe(e,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){We(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");We(t,[this.annotation],"rect","annotation-note-bg"),We(t,[this.annotation],"text","annotation-note-label"),We(t,[this.annotation],"text","annotation-note-title");var e={height:0},o=this.a.select("text.annotation-note-label"),n=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,i=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,r=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,a={top:0,bottom:0,left:0,right:0};if("number"==typeof r?a={top:r,bottom:r,left:r,right:r}:r&&"object"===(void 0===r?"undefined":xe(r))&&(a=we(a,r)),this.annotation.note.title){var s=this.a.select("text.annotation-note-title");s.text(this.annotation.note.title),s.attr("fill",this.annotation.color),s.attr("font-weight","bold"),s.call(Je,n,i),e=s.node().getBBox()}o.text(this.annotation.note.label).attr("dx","0"),o.call(Je,n,i),o.attr("y",1.1*e.height||0),o.attr("fill",this.annotation.color);var c=this.getNoteBBox();this.a.select("rect.annotation-note-bg").attr("width",c.width+a.left+a.right).attr("height",c.height+a.top+a.bottom).attr("x",c.x-a.left).attr("y",-a.top).attr("fill","white").attr("fill-opacity",0)}}}]),e}(Me),je=Ie(Le,{className:"label",note:{align:"middle"}}),Ue=Ie(Le,{className:"callout",note:{lineType:"horizontal"}}),ze=Ie(Ue,{className:"callout elbow",connector:{type:"elbow"}}),$e=Ie(Ue,{className:"callout curve",connector:{type:"curve"}}),Be=Ie(Me,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),Fe=Ie(Le,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),Ye=Ie(Le,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),He=function(t){function e(){return ve(this,e),ke(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Se(e,t),Oe(e,[{key:"mapY",value:function(t){be(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapY",this).call(this,t);var o=this.annotation;(o.subject.x1||o.subject.x2)&&o.data&&t.y&&(o.y=t.y(o.data)),!o.subject.x1&&!o.subject.x2||o.x||(o.x=o.subject.x1||o.subject.x2)}},{key:"mapX",value:function(t){be(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapX",this).call(this,t);var o=this.annotation;(o.subject.y1||o.subject.y2)&&o.data&&t.x&&(o.x=t.x(o.data)),!o.subject.y1&&!o.subject.y2||o.y||(o.y=o.subject.y1||o.subject.y2)}}]),e}(Ue),qe=Ie(He,{className:"callout xythreshold",subject:{type:"threshold"}}),We=function(t,e,o,n,i){var r=t.selectAll(o+"."+(i||n)).data(e);return r.enter().append(o).merge(r).attr("class",n),r.exit().remove(),t},Xe=function(t,e,o){var n=o.component,i=o.name;n&&n.on("mouseover.annotations",(function(){t.call(i+"over",n,e)})).on("mouseout.annotations",(function(){return t.call(i+"out",n,e)})).on("click.annotations",(function(){return t.call(i+"click",n,e)}))},Je=function(t,e,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each((function(){for(var t=ct(this),i=t.text().split(o||/[ \t\r\n]+/).reverse().filter((function(t){return""!==t})),r=void 0,a=[],s=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");r=i.pop();)a.push(r),s.text(a.join(" ")),s.node().getComputedTextLength()>e&&a.length>1&&(a.pop(),s.text(a.join(" ")),a=[r],s=t.append("tspan").attr("x",0).attr("dy",n+"em").text(r))}))},Ke=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(e).nodes().reduce((function(t,e){var o=e.getBBox();t.x=Math.min(t.x,o.x),t.y=Math.min(t.y,o.y),t.width=Math.max(t.width,o.width);var n=e&&e.attributes&&e.attributes.y;return t.height=Math.max(t.height,(n&&parseFloat(n.value)||0)+o.height),t}),{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function Ze(){var t=[],e=void 0,o=void 0,n=[],i={},r={},a=!1,s=void 0,c=Ue,l=void 0,u=void 0,h=vt("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart"),d=void 0,p=function(o){d=o,a||o.selectAll("circle.handle").remove();var p=t.map((function(t){return t.type||(t.type=c),t.disable||(t.disable=n),new Ee(t)}));e=e||new Re({annotations:p,accessors:i,accessorsInverse:r,ids:s}),o.selectAll("g").data([e]).enter().append("g").attr("class","annotations");var f=o.select("g.annotations");We(f,e.annotations,"g","annotation"),f.selectAll("g.annotation").each((function(t){var e=ct(this);e.attr("class","annotation"),We(e,[t],"g","annotation-connector"),We(e,[t],"g","annotation-subject"),We(e,[t],"g","annotation-note"),We(e.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:e,annotation:t,textWrap:l,notePadding:u,editMode:a,dispatcher:h,accessors:i}),t.type.draw(),t.type.drawText&&t.type.drawText()}))};return p.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",e.json),window.copy(JSON.stringify(e.json.map((function(t){return delete t.type,t})))),p},p.update=function(){return t&&e&&(t=e.annotations.map((function(t){return t.type.draw(),t}))),p},p.updateText=function(){return e&&(e.updateText(l),t=e.annotations),p},p.updatedAccessors=function(){return e.setPositionWithAccessors(),t=e.annotations,p},p.disable=function(o){return arguments.length?(n=o,e&&(e.updateDisable(n),t=e.annotations),p):n},p.textWrap=function(o){return arguments.length?(l=o,e&&(e.updateTextWrap(l),t=e.annotations),p):l},p.notePadding=function(o){return arguments.length?(u=o,e&&(e.updateNotePadding(u),t=e.annotations),p):u},p.type=function(o,n){return arguments.length?(c=o,e&&(e.annotations.map((function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=c,t.subject=n&&n.subject||t.subject,t.connector=n&&n.connector||t.connector,t.note=n&&n.note||t.note})),t=e.annotations),p):c},p.annotations=function(o){return arguments.length?(t=o,e&&e.annotations&&(t.some((function(t){return!t.type||"[object Object]"!==t.type.toString()}))?(e=null,p(d)):e.annotations=t),p):e&&e.annotations||t},p.context=function(t){return arguments.length?(o=t,p):o},p.accessors=function(t){return arguments.length?(i=t,p):i},p.accessorsInverse=function(t){return arguments.length?(r=t,p):r},p.ids=function(t){return arguments.length?(s=t,p):s},p.editMode=function(o){return arguments.length?(a=o,d&&d.selectAll("g.annotation").classed("editable",a),e&&(e.editMode(a),t=e.annotations),p):a},p.collection=function(t){return arguments.length?(e=t,p):e},p.on=function(){var t=h.on.apply(h,arguments);return t===h?p:t},p}const Qe={annotation:Ze,annotationTypeBase:Me,annotationLabel:je,annotationCallout:Ue,annotationCalloutCurve:$e,annotationCalloutElbow:ze,annotationCalloutCircle:Fe,annotationCalloutRect:Ye,annotationXYThreshold:qe,annotationBadge:Be,annotationCustomType:Ie}},376:(t,e,o)=>{o.r(e),o.d(e,{default:()=>_});var n=o(72),i=o.n(n),r=o(825),a=o.n(r),s=o(659),c=o.n(s),l=o(56),u=o.n(l),h=o(540),d=o.n(h),p=o(113),f=o.n(p),y=o(11),g={};g.styleTagTransform=f(),g.setAttributes=u(),g.insert=c().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=d(),i()(y.A,g);const _=y.A&&y.A.locals?y.A.locals:void 0},72:t=>{var e=[];function o(t){for(var o=-1,n=0;n<e.length;n++)if(e[n].identifier===t){o=n;break}return o}function n(t,n){for(var r={},a=[],s=0;s<t.length;s++){var c=t[s],l=n.base?c[0]+n.base:c[0],u=r[l]||0,h="".concat(l," ").concat(u);r[l]=u+1;var d=o(h),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var f=i(p,n);n.byIndex=s,e.splice(s,0,{identifier:h,updater:f,references:1})}a.push(h)}return a}function i(t,e){var o=e.domAPI(e);return o.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;o.update(t=e)}else o.remove()}}t.exports=function(t,i){var r=n(t=t||[],i=i||{});return function(t){t=t||[];for(var a=0;a<r.length;a++){var s=o(r[a]);e[s].references--}for(var c=n(t,i),l=0;l<r.length;l++){var u=o(r[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=c}}},659:t=>{var e={};t.exports=function(t,o){var n=function(t){if(void 0===e[t]){var o=document.querySelector(t);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(t){o=null}e[t]=o}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(o)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,o)=>{t.exports=function(t){var e=o.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(o){!function(t,e,o){var n="";o.supports&&(n+="@supports (".concat(o.supports,") {")),o.media&&(n+="@media ".concat(o.media," {"));var i=void 0!==o.layer;i&&(n+="@layer".concat(o.layer.length>0?" ".concat(o.layer):""," {")),n+=o.css,i&&(n+="}"),o.media&&(n+="}"),o.supports&&(n+="}");var r=o.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,o)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},734:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.renderSvgAnnotations=function(t){if(!i.state.svg)return;f&&f.remove(),f=i.state.svg.append("g").attr("class","d3-annotations");const e=[];if(t.svgAnnotations&&e.push(...t.svgAnnotations),t.clumps.forEach((o=>{if(o.svgAnnotations){const n=o.svgAnnotations.map((e=>{let n;if(o.superdot){const t=i.state.superdots.find((t=>(0,r.sameTypesInClumps)(o,t.viewClump)));t?n=t:(console.error(`Clump ${o.group.name} does not have a corresponding superdot`),n={x:0,y:0})}else n=o.group;return{...e,target:n,id:e.id||`annotation-${o.group.id}-${t.id}}`}}));e.push(...n)}})),t.sankeyGroups&&t.sankeyGroups.forEach((o=>{if(o.svgAnnotations){const n=o.svgAnnotations.map((e=>({...e,target:o.sankey,id:e.id||`annotation-${o.sankey.id}-${t.id}`})));e.push(...n)}})),t.images&&t.images.forEach((o=>{if(o.svgAnnotations){const n=o.svgAnnotations.map((e=>({...e,target:o.image,id:e.id||`annotation-${o.image.id}--${t.id}`})));e.push(...n)}})),p=e,0===e.length)return;const o=y(e),a=n.annotation().notePadding(10);o.forEach(((t,o)=>{e[o]&&e[o].note.wrap&&(t.wrap=e[o].note.wrap)})),a.annotations(o),a.textWrap(120),f&&(f.call(a),d(f))},e.updateSvgAnnotationPositions=function(){if(!f||0===p.length)return;const t=y(p),e=n.annotation().notePadding(10);t.forEach(((t,e)=>{p[e]&&p[e].note.wrap&&(t.wrap=p[e].note.wrap)})),e.annotations(t),e.textWrap(120),f&&(f.call(e),d(f))},window.d3;const n=window.d3Annotation,i=o(569),r=o(566),a=o(3),s=o(613),c=o(921),l=o(636),u=o(160),h=o(114);function d(t){t.selectAll(".annotation-note-bg").attr("fill-opacity",1)}let p=[],f=null;function y(t){return t.map((t=>{const e=function(t){let e={x:0,y:0},o={left:0,right:0,top:0,bottom:0},n={start:{x:0,y:0},end:{x:0,y:0}},c={x:0,y:0};if((0,r.isDotData)(t.target)&&!(0,u.isSuperdot)(t.target))e={x:t.target.x||0,y:t.target.y||0},o={left:e.x-i.state.dotRadius,right:e.x+i.state.dotRadius,top:e.y-i.state.dotRadius,bottom:e.y+i.state.dotRadius};else if((0,u.isSuperdot)(t.target))e={x:t.target.x||0,y:t.target.y||0},o={left:e.x-t.target.radius,right:e.x+t.target.radius,top:e.y-t.target.radius,bottom:e.y+t.target.radius};else if(t.target instanceof l.SimImage){const n=t.target.position;e={x:n.x,y:n.y},o={left:e.x-t.target.size.width/2,right:e.x+t.target.size.width/2,top:e.y-t.target.size.height/2,bottom:e.y+t.target.size.height/2}}else t.target instanceof a.Sankey?(e=t.target.getJunctionCenter(),n=t.target.getEndpointPositions()):t.target instanceof s.VoterGroup?(e=(0,h.calculateGroupCenters)([t.target]).get(t.target),console.warn("Attachment points for groups are not implemented yet")):(e=t.target,o={left:e.x,right:e.x,top:e.y,bottom:e.y});if(t.target instanceof a.Sankey)if("start"===t.targetAnchorLink)c=n.start;else if("end"===t.targetAnchorLink)c=n.end;else if("superdot-link"===t.targetAnchorLink&&t.targetFlowGroup){const e=t.targetFlowRatio||.5;c=t.target.getPositionFromSuperdotToJunction(t.targetFlowGroup,e)}else c=e;else"left"===t.targetAnchorX?c.x=o.left:"right"===t.targetAnchorX?c.x=o.right:c.x=e.x,"top"===t.targetAnchorY?c.y=o.top:"bottom"===t.targetAnchorY?c.y=o.bottom:c.y=e.y;return{x:c.x+(t.targetOffset?.x||0),y:c.y+(t.targetOffset?.y||0)}}(t),o={...t.note},n={id:t.id||`annotation-${Math.random().toString(36).substr(2,9)}`,note:o,className:t.className||"",type:g(t.type),connector:t.connector||{}};if(t.fixedPosition?(n.x=e.x,n.y=e.y,n.dx=t.fixedPosition.x-e.x,n.dy=t.fixedPosition.y-e.y):(n.x=e.x,n.y=e.y,n.dx=t.dx||0,n.dy=t.dy||0),t.subject)if("calloutCircle"===t.type)if((0,u.isSuperdot)(t.target))n.subject={...t.subject,radius:t.target.radius};else if((0,r.isDotData)(t.target)||t.target instanceof s.VoterGroup||"object"==typeof t.target&&"x"in t.target&&"y"in t.target)if(t.subject.radius)n.subject=t.subject;else{const o=e.x,r=e.y;let a=0;if(t.subject.includeElements&&t.subject.includeElements.length>0)t.subject.includeElements.forEach((t=>{if("string"==typeof t){const e=Object.values(c.VOTER_GROUPS).find((e=>e.id===t));if(e)i.state.displayData.forEach((t=>{if(void 0!==t.x&&void 0!==t.y&&e.shouldIncludeDot(t)){const e=t.x-o,n=t.y-r,s=Math.sqrt(e*e+n*n)+i.state.dotRadius;a=Math.max(a,s)}}));else{const e=i.state.superdots.find((e=>e.id===t));if(e){const t=e.x-o,n=e.y-r,i=Math.sqrt(t*t+n*n)+e.radius;a=Math.max(a,i)}else{const e=Object.values(i.state.images).find((e=>e.id===t));if(e){const t=e.position.x,n=e.position.y,i=t-o,s=n-r,c=Math.sqrt(i*i+s*s)+Math.max(e.size.width,e.size.height)/2;a=Math.max(a,c)}}}}else if(t instanceof s.VoterGroup)i.state.displayData.forEach((e=>{if(void 0!==e.x&&void 0!==e.y&&t.shouldIncludeDot(e)){const t=e.x-o,n=e.y-r,s=Math.sqrt(t*t+n*n)+i.state.dotRadius;a=Math.max(a,s)}}));else if(t instanceof l.SimImage){const e=t.position.x,n=t.position.y,i=e-o,s=n-r,c=Math.sqrt(i*i+s*s)+Math.max(t.size.width,t.size.height)/2;a=Math.max(a,c)}else if("x"in t&&"y"in t){const e=t.x-o,n=t.y-r,i=Math.sqrt(e*e+n*n);a=Math.max(a,i)}}));else{const t=150;i.state.displayData.forEach((e=>{if(void 0!==e.x&&void 0!==e.y){const n=e.x-o,s=e.y-r,c=Math.sqrt(n*n+s*s)+i.state.dotRadius;c<t&&(a=Math.max(a,c))}}))}const u=t.subject.radiusPadding||15,h=60,d=Math.max(a,h)+u;n.subject={...t.subject,radius:d}}else n.subject=t.subject;else n.subject=t.subject;return n}))}function g(t){switch(t){case"label":default:return n.annotationLabel;case"callout":return n.annotationCallout;case"calloutCircle":return n.annotationCalloutCircle;case"calloutRect":return n.annotationCalloutRect;case"threshold":return n.annotationXYThreshold}}},921:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MAX_RING_RADIUS=e.RING_SPACING=e.MIN_RING_SIZE=e.CURSOR_NODE_DATA=e.VOTER_GROUPS=e.VOTER_TYPES=e.VOTER_TYPE_KEYS=e.typeColors=e.targetColumn=e.COLLIDE_DISTANCE_MULT=e.MOUSE_CHARGE_STRENGTH=e.DOT_CHARGE_STRENGTH=e.GROUPED_FORCE_STRENGTH=e.RADIAL_STRENGTH=e.smallDotRadius=e.largeDotRadius=void 0,e.createVoterGroups=function(){Object.keys(e.VOTER_TYPES).forEach((t=>{e.VOTER_GROUPS[t]=n.VoterGroup.fromType(e.VOTER_TYPES[t])})),e.VOTER_GROUPS.NON_DONATING_VOTERS=n.VoterGroup.fromGroups([e.VOTER_GROUPS.REMAINING_NON_DONATING_VOTERS,e.VOTER_GROUPS.NON_DONATING_NEEDED_FOR_FUNDING,e.VOTER_GROUPS.NON_DONATING_BELOW_TAX_THRESHOLD],"Non-donating voters","Non-donating voters"),e.VOTER_GROUPS.NON_DONATING_WITH_REFORM=n.VoterGroup.fromGroups([e.VOTER_GROUPS.REMAINING_NON_DONATING_VOTERS,e.VOTER_GROUPS.NON_DONATING_BELOW_TAX_THRESHOLD],"Non-donating voters with reform","Non-donating voters with reform"),e.VOTER_GROUPS.ABOVE_TAX_THRESHOLD=n.VoterGroup.fromGroups([e.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,e.VOTER_GROUPS.REMAINING_NON_DONATING_VOTERS,e.VOTER_GROUPS.NON_DONATING_NEEDED_FOR_FUNDING],"Above the tax threshold","Above the tax threshold"),e.VOTER_GROUPS.BELOW_TAX_THRESHOLD=n.VoterGroup.fromGroups([e.VOTER_GROUPS.NON_DONATING_BELOW_TAX_THRESHOLD],"Below the tax threshold","Below the tax threshold"),e.VOTER_GROUPS.DONORS_1_999=new n.VoterGroup([e.VOTER_TYPES.DONORS_1_199,e.VOTER_TYPES.DONORS_200_499,e.VOTER_TYPES.DONORS_500_999],"Donors $1-999","Donors $1-999"),e.VOTER_GROUPS.ALL_DONORS=n.VoterGroup.fromGroups([e.VOTER_GROUPS.DONORS_1_999,e.VOTER_GROUPS.DONORS_OVER_1000],"All Donors","All Donors"),e.VOTER_GROUPS.ALL_VOTERS=n.VoterGroup.fromGroups([e.VOTER_GROUPS.ALL_DONORS,e.VOTER_GROUPS.NON_DONATING_VOTERS],"All Voters","All Voters"),e.VOTER_GROUPS.ALL_ELIGIBLE=n.VoterGroup.fromGroups([e.VOTER_GROUPS.NON_DONATING_VOTERS,e.VOTER_GROUPS.ELIGIBLE_NON_VOTERS],"All Eligible","All Eligible"),e.VOTER_GROUPS.EVERYONE=n.VoterGroup.fromGroups([e.VOTER_GROUPS.ALL_VOTERS,e.VOTER_GROUPS.ELIGIBLE_NON_VOTERS],"Everyone","Everyone"),e.VOTER_GROUPS.ALL_DONORS_AFTER_REFORM=n.VoterGroup.fromGroups([e.VOTER_GROUPS.DONORS_1_999,e.VOTER_GROUPS.DONORS_OVER_1000,e.VOTER_GROUPS.NON_DONATING_NEEDED_FOR_FUNDING],"All donors after reform","All donors after reform")};const n=o(613);e.largeDotRadius=5,e.smallDotRadius=2,e.RADIAL_STRENGTH=.3,e.GROUPED_FORCE_STRENGTH=.1,e.DOT_CHARGE_STRENGTH=-.75,e.MOUSE_CHARGE_STRENGTH=-50,e.COLLIDE_DISTANCE_MULT=1.2,e.targetColumn="Average 2016-2022 Dots",e.typeColors={grey:"#ABABAB",purple:"#833B8D",gold:"#FFC803",cyan:"#67D7BE",teal:"#64C1CD",blue:"#5899EA"},e.VOTER_TYPE_KEYS={"Eligible non-voters":"ELIGIBLE_NON_VOTERS","Remaining Non-donating voters":"REMAINING_NON_DONATING_VOTERS","Donors >$1000":"DONORS_OVER_1000","Donors $500-999":"DONORS_500_999","Donors $200-499":"DONORS_200_499","Donors $1-199":"DONORS_1_199","Non-donating voters below tax threshold":"NON_DONATING_BELOW_TAX_THRESHOLD","Non-donating voters needed for new funding goals":"NON_DONATING_NEEDED_FOR_FUNDING"},e.VOTER_TYPES={ELIGIBLE_NON_VOTERS:new n.VoterType("Eligible non-voters","Eligible voters who don't vote","#ABABAB"),REMAINING_NON_DONATING_VOTERS:new n.VoterType("Remaining Non-donating voters","Non-donating voters","#833B8D"),DONORS_OVER_1000:new n.VoterType("Donors >$1000","Huge Donors (>$1000)","#FFC803"),DONORS_500_999:new n.VoterType("Donors $500-999","Large Donors ($500-$999)","#67D7BE"),DONORS_200_499:new n.VoterType("Donors $200-499","Medium Donors ($200-$499)","#64C1CD"),DONORS_1_199:new n.VoterType("Donors $1-199","Small Donors ($1-$199)","#5899EA"),NON_DONATING_BELOW_TAX_THRESHOLD:new n.VoterType("Below the tax threshold","Eligible voters who don't make enough to pay income tax","#833B8D"),NON_DONATING_NEEDED_FOR_FUNDING:new n.VoterType("Non-donating voters needed for new funding goals","Non-donating voters needed for new funding goals","#833B8D"),SUPERDOT:new n.VoterType("SUPERDOT","Superdot","black"),MOUSE:new n.VoterType("MOUSE","Mouse","green")},e.VOTER_GROUPS={},e.CURSOR_NODE_DATA={id:"cursor-node",type:e.VOTER_TYPES.MOUSE,x:0,y:0,fx:0,fy:0,sankeys:new Map},e.MIN_RING_SIZE=20,e.RING_SPACING=10,e.MAX_RING_RADIUS=150},646:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.loadVoterData=async function(t){const e=await n.csv(t),o=/(\d{4}|\bAverage \d{4}-\d{4}\b) Dots/,a=Object.keys(e[0]||{}).filter((t=>o.test(t))).map((t=>t.replace(" Dots","")));r.state.availableYears=a,r.state.yearData={},a.forEach((t=>{r.state.yearData[t]={}})),e.forEach((t=>{const e=t.Group;if(!i.VOTER_TYPE_KEYS[e])return;const o=i.VOTER_TYPE_KEYS[e];a.forEach((e=>{const n=t[`${e} Dots`];n&&!isNaN(+n)&&(r.state.yearData[e][o]=+n)}))}));const s="Average 2016-2022";return r.state.currentYear=s,Object.keys(i.VOTER_TYPES).forEach((t=>{r.state.yearData[s]&&void 0!==r.state.yearData[s][t]&&(i.VOTER_TYPES[t].dotCount=r.state.yearData[s][t])})),Object.keys(i.VOTER_GROUPS).forEach((t=>{i.VOTER_GROUPS[t].updateDotCount()})),console.log("Available years:",r.state.availableYears),console.log("Year data:",r.state.yearData),Object.values(i.VOTER_TYPES)},e.flattenData=function(t){const e=[];return t.forEach((t=>{for(let o=0;o<t.dotCount;o++)e.push({id:`${t.id}-${o}`,type:t,sankeys:new Map})})),e},e.updateDisplayData=function(t){console.log("Updating data"),r.state.displayData=r.state.flattenedData.slice(),t?(r.state.displayData=r.state.displayData.filter((e=>e.type.belongsInView(t))),r.state.displayData.forEach((e=>{e.activeClump=e.type.matchedClumpInView(t)})),(0,a.addCursorNode)()):(0,a.addCursorNode)()};const n=window.d3,i=o(921),r=o(569),a=o(517)},795:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.pointerMoveHandler=function(t){if(!i.state.cursorNode||i.state.disableCursorPush)return;const[e,o]=n.pointer(t);i.state.cursorNode.fx=e,i.state.cursorNode.fy=o,i.state.simulation.alpha(1).restart()},e.pointerOutHandler=function(){i.state.cursorNode&&(i.state.cursorNode.fx=-1e4,i.state.cursorNode.fy=-1e4),i.state.simulation.alpha(1).restart()},e.setViewFromVisibleTriggers=c,e.initEventListeners=function(){n.select(window).on("scroll",(function(){c()})),n.select("body").on("pointermove mouseover mouseout ",(t=>{i.state.disableCursorPush&&n.select("#dot-info").html((0,a.getDotInfo)(t))})),n.selectAll(".scroll-arrow").on("click",(function(){console.log("Scrolling to next trigger div");let t=this?.parentElement;for(;t&&!t.classList.contains("trigger-div");)t=t.parentElement;if(t){const e=Array.from(document.querySelectorAll(".trigger-div")),o=e.indexOf(t);o>=0&&o<e.length-1&&e[o+1].scrollIntoView({behavior:"smooth",block:"center"})}})),n.select("#toggle-cursor-push").on("click",(()=>{i.state.disableCursorPush=!i.state.disableCursorPush})),n.select("#stop-everything").on("click",(function(){const t=n.select(this);i.state.isStopped?(console.log("== RESUMING SIMULATION AND ANIMATIONS =="),i.state.resumeSimulation(),n.selectAll("*").interrupt(),n.select(window).on("scroll",(function(){c()})),t.text("STOP EVERYTHING").classed("active",!1)):(console.log("== STOPPING SIMULATION AND ANIMATIONS =="),console.log("You can now copy logs easily."),i.state.stopSimulation(),n.selectAll("*").interrupt(),n.select(window).on("scroll",null),t.text("RESUME EVERYTHING").classed("active",!0))})),n.select("#pause-simulation").on("click",(()=>i.state.simulation.stop())),n.select("#resume-simulation").on("click",(()=>i.state.simulation.restart()))};const n=window.d3,i=o(569),r=o(306),a=o(566);var s=null;function c(){const t=document.querySelectorAll(".trigger-div");let e=!1;for(const o of Array.from(t)){const t=o.getBoundingClientRect(),n=o.getAttribute("data-view");if(t.top+t.height/2>=100&&t.bottom<=window.innerHeight-100)if(n&&r.viewPresets[n]){if(e=!0,s!==n){(0,i.requestView)(r.viewPresets[n]),s=n,console.log(`View set to ${n}`);break}}else console.error(`Error: view ${n} not found!`)}}},636:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SimImage=void 0;const n=o(569);e.SimImage=class{id;src;alt;_active=!1;_position={x:0,y:0};_size={width:0,height:0};offset={x:0,y:0};_originalOffset;imageElement;listeners=[];initPosition={x:0,y:0};initSize={width:0,height:0};constructor(t){if(!t.id||""===t.id)throw new Error("ImageConfig must have an id");if(!t.src||""===t.src)throw new Error("ImageConfig must have a source url");if(!t.alt||""===t.alt)throw new Error("ImageConfig must have an alt description");this.id=t.id,this.src=t.src,this.alt=t.alt,this.initPosition=this._position=t.position||{x:0,y:0},this.initSize=this._size=t.size||{width:0,height:0},this.offset=t.offset||{x:0,y:0}}get position(){return this._position}set position(t){this._position=t,this.imageElement&&("0"===this.imageElement.style("opacity")||"none"===this.imageElement.style("display")?this.imageElement.attr("x",t.x).attr("y",t.y).attr("transform",`translate(-${this.size.width/2}, -${this.size.height/2})`):this.imageElement.transition(`${this.id}-move`).duration(500).attr("x",t.x).attr("y",t.y).attr("transform",`translate(-${this.size.width/2}, -${this.size.height/2})`))}resetPosition(){this.position=this.initPosition}resetSize(){this.size=this.initSize}get size(){return this._size}set size(t){this._size=t,this.imageElement&&this.imageElement.transition(`${this.id}-resize`).duration(500).attr("width",t.width).attr("height",t.height).attr("transform",`translate(-${t.width/2}, -${t.height/2})`)}set active(t){this._active=t}get active(){return this._active}addToGroup(t){return this.imageElement&&!this.imageElement.empty()?(console.warn("This image is already in a group"),!1):(this.imageElement=t.append("image").attr("class",`icon-${this.id}`).attr("href",this.src).attr("x",this.position.x).attr("y",this.position.y).attr("transform",`translate(-${this.size.width/2}, -${this.size.height/2})`).attr("width",this.size.width).attr("height",this.size.height).style("transform-box","fill-box").style("transform-origin","center"),this._active=!0,!0)}removeFromGroup(t){this.imageElement?(t?this.imageElement.transition().duration(t).style("opacity",0).remove().on("end",(()=>{this.imageElement=void 0})):(this.imageElement.remove(),this.imageElement=void 0),this._active=!1):console.warn("This image does not have an associated SVG element")}show(){return new Promise(((t,e)=>{if(!this.imageElement){if(!n.state.svgGroups.imgGroup)return void console.warn("This image does not have an associated SVG group");this.addToGroup(n.state.svgGroups.imgGroup)}this.imageElement?.style("display","block").style("opacity",0).attr("width",this.size.width/2).attr("height",this.size.height/2).attr("transform",`translate(-${this.size.width/4}, -${this.size.height/4})`).transition(`${this.id}-show`).duration(500).style("opacity",1).attr("width",this.size.width).attr("height",this.size.height).attr("transform",`translate(-${this.size.width/2}, -${this.size.height/2})`),this._active=!0,t()}))}hide(){return new Promise(((t,e)=>{this.imageElement?.style("opacity",1).attr("width",this.size.width).attr("height",this.size.height).attr("transform",`translate(-${this.size.width/2}, -${this.size.height/2})`).transition(`${this.id}-show`).duration(500).style("opacity",0).attr("width",this.size.width/2).attr("height",this.size.height/2).attr("transform",`translate(-${this.size.width/4}, -${this.size.height/4})`).on("end",(()=>{this.imageElement?.style("display","none")})),this._active=!1,t()}))}addListener(t,e){this.imageElement?("scroll"===t?window.addEventListener("scroll",e):this.imageElement.on(t,e),this.listeners.push({type:t,callback:e})):console.warn("This image does not have an associated SVG element")}removeListeners(){this.listeners.forEach((t=>{"scroll"===t.type?window.removeEventListener("scroll",t.callback):this.imageElement?.on(t.type,null)}))}}},185:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LinkManager=void 0;const n=window.d3,i=o(569),r=o(921),a=o(160),s={colorScheme:{standard:"rgba(80, 255, 100, 0.4)",bundle:"rgba(80, 255, 100, 0.6)"},transitionDurations:{enter:700,update:300,exit:700},bundleLinkDelay:500};e.LinkManager=class{links=[];svgLinkGroup=null;config;verticalLinkGenerator;horizontalLinkGenerator;sankeys=[];constructor(t={}){this.svgLinkGroup=i.state.svgGroups.linksGroup,this.config={...s,...t},this.verticalLinkGenerator=this.createVerticalLinkGenerator(),this.horizontalLinkGenerator=this.createHorizontalLinkGenerator()}activeSankeys(){return this.sankeys.filter((t=>t.active))}createHighlightPath(t){if(!t.flowConfig?.highlightPath)return;const e=t.flowConfig.highlightPath,o=e.fromGroup,n=e.toGroup;if(!o&&!n)return;const r=[];o&&i.state.displayData.forEach((t=>{t.type.id===o&&r.push(t)})),n&&i.state.displayData.forEach((t=>{t.type.id===n&&r.push(t)})),0!==r.length&&this.links.forEach((e=>{e.sankey===t&&e.dot&&r.some((t=>t.id===e.dot?.id))&&(e.highlightPath=!0)}))}calculateOffsetPath(t,e,o=0,n=1){const i=t.getTotalLength();if(i<10)return t.getAttribute("d")||"";const r="number"==typeof e,a=r?0:e.x,s=r?0:e.y,c=r?e:0;o=Math.max(0,Math.min(.99,o)),n=Math.max(o+.01,Math.min(1,n));const l=Math.max(10,Math.floor(i/20)),u=[],h=Math.floor(o*l),d=Math.ceil(n*l);for(let e=h;e<=d;e++){const o=e/l,n=t.getPointAtLength(o*i);u.push({x:n.x,y:n.y})}const p=[];for(let t=0;t<u.length;t++){const e={x:u[t].x,y:u[t].y};if(0!==c){let o=0,n=0;0===t?u.length>1&&(o=u[1].x-u[0].x,n=u[1].y-u[0].y):t===u.length-1?(o=u[t].x-u[t-1].x,n=u[t].y-u[t-1].y):(o=u[t+1].x-u[t-1].x,n=u[t+1].y-u[t-1].y);const i=Math.sqrt(o*o+n*n);i>0&&(o/=i,n/=i);const r=-n,a=o;e.x+=r*c,e.y+=a*c}p.push({x:e.x+a,y:e.y+s})}if(0===p.length)return"";let f=`M${p[0].x},${p[0].y}`;for(let t=1;t<p.length;t++)f+=` L${p[t].x},${p[t].y}`;return f}calculateDotConnectionOffset(t,e){const o=e.allSankeysInSameDirectionForDot(t),n=o.length,i=e.linkThickness(t)||1;return n<=1?0:-n*i/2+o.indexOf(e)*i+i/2}createVerticalLinkGenerator(){const t=n.linkVertical().x((function(t){return t&&"number"==typeof t.x?t.x:0})).y((function(t){return t&&"number"==typeof t.y?t.y:0}));return function(e){if(!e||!e.source||!e.target)return"M0,0L0,0";try{return t(e)??"M0,0L0,0"}catch(t){return"M0,0L0,0"}}}createHorizontalLinkGenerator(){const t=n.linkHorizontal().x((function(t){return t&&"number"==typeof t.x?t.x:0})).y((function(t){return t&&"number"==typeof t.y?t.y:0}));return function(e){if(!e||!e.source||!e.target)return"M0,0L0,0";try{return t(e)??"M0,0L0,0"}catch(t){return"M0,0L0,0"}}}getLinkGenerator(t){return"vertical"===t?this.verticalLinkGenerator:this.horizontalLinkGenerator}setVisibleSankeys(t){const e=[],o=this.activeSankeys();return t?(o.forEach((o=>{t.includes(o)||e.push(this.hideSankey(o))})),t.forEach((t=>{this.sankeyExists(t)||this.sankeys.push(t);const o=t.getImage();if(o){let n;i.state.images.includes(o)||i.state.images.push(o),o.active||e.push(o.show()),t.target.image?n=t.target:t.source.image&&(n=t.source),n&&(n.position?o.position=n.position:o.resetPosition(),n.size?o.size=n.size:o.resetSize())}e.push(this.showSankey(t))})),Promise.all(e).then((()=>{}))):(o.forEach((t=>{e.push(this.hideSankey(t));const o=t.getImage();o&&e.push(o.hide())})),Promise.all(e).then((()=>{})))}toggleSankey(t){return t.active?this.removeSankey(t):this.addSankey(t)}addSankey(t){return t.active?Promise.resolve():t.validEndpoints()?(this.createLinksForSankey(t),t.active=!0,this.renderLinks()):Promise.resolve()}showSankey(t){return this.sankeyExists(t)&&!t.active?this.addSankey(t):Promise.resolve()}hideSankey(t){return this.sankeyExists(t)&&t.active?this.removeSankey(t):Promise.resolve()}removeSankey(t){return new Promise((e=>{if(0===t.getLinks().length)return t.active=!1,void e();t.removeFromDotData();let o=0,n=0;const i=this.svgLinkGroup?.selectAll("path.link").filter((e=>e.id.startsWith(`${t.id}-`)||e.id.startsWith(`${t.id}-bundle-`)));o=i?.size()||0,o>0&&i?i.style("opacity",0).on("end",(()=>{n++,n>=o&&e()})).remove():e(),this.links=this.links.filter((e=>!e.id.startsWith(`${t.id}-`)&&!e.id.startsWith(`${t.id}-bundle-`))),this.svgLinkGroup&&this.svgLinkGroup.selectAll(`path.offset-arrow-path.sankey-${t.id}`).remove(),t.active=!1}))}sortDotsByPosition(t,e){return"horizontal"===e?[...t].sort(((t,e)=>(t.y??0)-(e.y??0))):[...t].sort(((t,e)=>(t.x??0)-(e.x??0)))}createLinksForSankey(t){if(!t.getWeightedGroups())return void console.warn(`No groups found for Sankey '${t.id}'`);const e=t.getImage();if(!e?.active)return;const o=t.getJunctionCenter(),n=this.calculateJunctionOffsets(t),i=t.flowForDots();if(!i)return;let r=t.getDotsForLinks();if(!r.length)return;r=this.sortDotsByPosition(r,t.orientation),r.forEach(((e,r)=>{const a=t.linkThickness(e)||1,s=n.get(e)||0,c=t.isVertical()?s:0,l=t.isHorizontal()?s:0;e.sankeys.set(t,i);const u=this.calculateDotConnectionOffset(e,t),h=t.isVertical()?u:0,d=t.isHorizontal()?u:0,p={x:(e.x||0)+h,y:(e.y||0)+d},f={x:o.x+c,y:o.y+l},y={x:f.x,y:f.y,isFixed:!0,index:r,sankey:t},g={x:p.x,y:p.y,dot:e,sankey:t},_={id:`${t.id}-link-${r}`,source:t.dotsAreSource()?g:y,target:t.dotsAreSource()?y:g,width:a,sankey:t,dot:e};this.links.push(_)}));const a=t.dotsAreSource()?o:e.position,s=t.dotsAreSource()?e.position:o;this.createBundleLink(t,a,s),t.flowConfig?.highlightPath&&this.createHighlightPath(t)}createBundleLink(t,e,o){const n={id:`${t.id}-bundle-link`,source:{x:e.x,y:e.y,isFixed:!0,sankey:t},target:{x:o.x,y:o.y,isFixed:!0,sankey:t},width:t.totalThickness,sankey:t};this.links.push(n)}calculateJunctionOffsets(t){const e=new Map,o=t.getDotsForLinks(),n=o.length*t.totalThickness,i=t.totalThickness/n;let r=-t.totalThickness/2;return o.forEach((o=>{const n=(t.linkThickness(o)||1)*i;e.set(o,r+n/2),r+=n})),e}groupJunctionsByProximity(){const t=new Map,e=new Set;return this.activeSankeys().forEach((o=>{if(e.has(o))return;const n=o.getJunctionCenter(),i=`junction-group-${t.size}`,r=[o];e.add(o),this.activeSankeys().forEach((t=>{if(o===t||e.has(t))return;const i=t.getJunctionCenter();Math.sqrt(Math.pow(n.x-i.x,2)+Math.pow(n.y-i.y,2))<=20&&(r.push(t),e.add(t))})),(r.length>1||this.getSankeyIndividualLinks(r[0]).length>0)&&t.set(i,r)})),t}getSankeyIndividualLinks(t){return this.links.filter((e=>e.id.startsWith(`${t.id}-link-`)&&!e.id.includes("bundle")))}updateSankeyJunctionPositions(){const t=this.groupJunctionsByProximity();let e=0,o=0;this.activeSankeys().forEach((t=>{t.isVertical()?e++:o++}));const n=e>=o;t.forEach(((t,e)=>{if(0===t.length)return;const o=this.sortSankeysByDotPositions(t.map((t=>({link:{},sankey:t}))),n).map((t=>t.sankey)),r=[];if(o.forEach((t=>{const e=this.getSankeyIndividualLinks(t);if(0===e.length)return;const o=t.dotsAreSource(),n=new Map;e.forEach((t=>{t.dot&&(n.has(t.dot)||n.set(t.dot,[]),n.get(t.dot).push(t))}));const a=Array.from(n.keys()).map((t=>i.state.displayData.find((e=>e.id===t.id))||i.state.superdots.find((e=>e.id===t.id)))).filter((t=>void 0!==t));this.sortDotsByPosition(a,t.orientation).forEach((e=>{(n.get(e)||[]).forEach((e=>{const n=o,i=n?e.target:e.source;r.push({link:e,sankey:t,isJunctionTarget:n,vertex:i,width:e.width||1})}))}))})),0===r.length)return;const a=r.reduce(((t,e)=>t+e.width),0),s=o[0].getJunctionCenter();let c=n?s.x:s.y;c-=a/2;const l=n?s.y:s.x;let u=c;r.forEach((t=>{const e=u+t.width/2;t.vertex.x=n?e:l,t.vertex.y=n?l:e,t.vertex.isFixed=!0,u+=t.width}))}))}renderLinks(){if(!this.svgLinkGroup)return Promise.resolve();const t=this.svgLinkGroup;return t.selectAll("path.offset-arrow-path").remove(),new Promise((e=>{const o=t.selectAll("path.link").data(this.links);let i=0,r=0;const a=()=>{r++,r>=i&&(this.createOffsetArrows(),e())},s=t=>(t.each((function(t){const e=n.select(this),o=t.sankey;if(!o)return;e.classed("arrow-start",!1).classed("arrow-end",!1).classed("arrow-mid",!1).classed("flow-dashed",!1).classed("animated-flow",!1).classed("animated-flow-markers",!1).classed("highlight-path",!1);const i=o.flowConfig;"arrow"===i.style&&i.arrowPosition&&("start"!==i.arrowPosition&&"both"!==i.arrowPosition||e.classed("arrow-start",!0),"end"!==i.arrowPosition&&"both"!==i.arrowPosition||e.classed("arrow-end",!0),"mid"===i.arrowPosition&&e.classed("arrow-mid",!0)),"dashed"===i.style&&e.classed("flow-dashed",!0),i.highlightPath&&(t.highlightPath?e.classed("highlight-path",!0).attr("stroke",i.highlightPath.color||o.color).attr("stroke-width",i.highlightPath.width||1.5*t.width):t.id.includes("bundle-link")&&e.attr("stroke",o.color).attr("stroke-width",t.width))})),t),c=o.enter().append("path").lower().attr("class","link").attr("stroke",(t=>t.sankey?.color||this.config.colorScheme.standard)).attr("fill","none").attr("stroke-width",(t=>t.width)).attr("d",(t=>this.getLinkGenerator(t.sankey?.orientation)(t))).attr("id",(t=>t.id)).style("opacity",0).call(s),l=c.size();i+=l,l>0&&c.style("opacity",1).on("end",a);const u=o.attr("stroke-width",(t=>t.width)).attr("stroke",(t=>t.sankey?.color||this.config.colorScheme.standard)).attr("id",(t=>t.id)).call(s),h=u.size();i+=h,h>0&&u.attr("d",(t=>this.getLinkGenerator(t.sankey?.orientation)(t))).on("end",a);const d=o.exit(),p=d.size();i+=p,p>0&&d.style("opacity",0).on("end",a).remove(),0===i&&e()}))}clearAll(){this.activeSankeys().forEach((t=>{this.removeSankey(t)})),this.links=[],this.svgLinkGroup&&this.svgLinkGroup.selectAll("path.offset-arrow-path").remove()}sankeyExists(t){return this.sankeys.some((e=>e.id===t.id))}tick(){try{if(this.updateSankeyJunctionPositions(),this.updateBundleLinkPositions(),this.updateLinkPositions(),this.svgLinkGroup){const t=this.svgLinkGroup.selectAll(".link").data(this.links,(t=>t.id)),e=t=>(t.each((function(t){const e=n.select(this),o=t.sankey;if(o){if(!e.classed("flow-dashed")&&!e.classed("animated-flow")){e.classed("flow-dashed",!1).classed("animated-flow",!1).classed("animated-flow-markers",!1).classed("highlight-path",!1);const t=o.flowConfig;("dashed"===t.style||t.dashed)&&e.classed("flow-dashed",!0)}o.flowConfig.highlightPath&&(t.highlightPath?e.classed("highlight-path",!0).attr("stroke",o.flowConfig.highlightPath.color||o.color).attr("stroke-width",o.flowConfig.highlightPath.width||1.5*t.width):t.id.includes("bundle-link")&&e.attr("stroke",o.color).attr("stroke-width",t.width))}})),t);t.attr("d",(t=>this.getLinkGenerator(t.sankey?.orientation)(t))).call(e),this.updateOffsetArrows()}}catch(t){console.warn(`Error in link tick function: ${t}`)}}trimPathEnd(t,e=.5){if(!t||t.length<5)return t;const o=t.split(/(?=[LMC])/);if(o.length<2)return t;const n=o[o.length-1],i=o[o.length-2];if("L"!==n[0]||"L"!==i[0])return t;const r=n.substring(1).split(",").map(Number),a=i.substring(1).split(",").map(Number);if(2!==r.length||2!==a.length)return t;const s=r[0]-a[0],c=r[1]-a[1],l=Math.sqrt(s*s+c*c);if(l<2*e)return t;const u=(l-e)/l,h=a[0]+s*u,d=a[1]+c*u;return o[o.length-1]=`L${h},${d}`,o.join("")}getArrowStyle(t,e,o=!1){const n={offset:8,trimStart:0,trimEnd:1,opacity:1,width:4,color:t.color};if(!t.flowConfig)return n;if(o&&t.flowConfig.junctionArrowStyle)return{...n,...t.flowConfig.arrowStyle,...t.flowConfig.junctionArrowStyle};let s={...n};if(t.flowConfig.arrowStyle&&(s={...s,...t.flowConfig.arrowStyle}),!t.flowConfig.groupArrowStyles||o)return s;let c="";if(e.dot?.type?.id){if(c=e.dot.type.id,c&&t.flowConfig.groupArrowStyles[c])return{...s,...t.flowConfig.groupArrowStyles[c]};if((0,a.isSuperdot)(e.dot)){const o=e.dot.id,n=i.state.view?.clumps.find((t=>t.superdot&&(0,a.superdotIDForClump)(t)===o));if(n){if(t.flowConfig.groupArrowStyles[n.group.id])return{...s,...t.flowConfig.groupArrowStyles[n.group.id]};const e=Object.keys(t.flowConfig.groupArrowStyles);for(const o of e){const e=r.VOTER_GROUPS[o]||Object.values(r.VOTER_GROUPS).find((t=>t.id===o));if(e&&n.group.sameTypesAs(e))return{...s,...t.flowConfig.groupArrowStyles[o]};if(e&&n.group.containsAllTypesFromGroup(e))return{...s,...t.flowConfig.groupArrowStyles[o]}}}}}return s}updateOffsetArrows(){this.svgLinkGroup&&this.svgLinkGroup.selectAll("path.link").filter((t=>{const e=t.sankey?.flowConfig;return"arrow"===e?.style||void 0!==e?.arrowStyle||void 0!==e?.groupArrowStyles||void 0!==e?.junctionArrowStyle})).each(((t,e,o)=>{const i=o[e],r=t.sankey;if(!r||!r.flowConfig)return;const a=t.id.includes("bundle-link"),s=this.getArrowStyle(r,t,a);let c=this.calculateOffsetPath(i,s.offset||8,s.trimStart||0,s.trimEnd||1);c=this.trimPathEnd(c,.5);const l=this.svgLinkGroup.selectAll("path.offset-arrow-path").filter((function(){return n.select(this).attr("d")===t.offsetArrowPath})),u=s.color||r.color,h=s.headColor||u,d=this.getOrCreateColoredMarker(h);l.size()>0?l.attr("d",c).attr("stroke",u).attr("stroke-width",s.width||4).style("opacity",s.opacity||1).attr("marker-end",`url(#${d})`):(this.svgLinkGroup.append("path").attr("class",`offset-arrow-path sankey-${r.id}`).attr("d",c).attr("stroke",u).attr("stroke-width",s.width||4).style("opacity",s.opacity||1).attr("marker-end",`url(#${d})`).lower(),this.svgLinkGroup.selectAll("path.link").raise()),t.offsetArrowPath=c}))}updateBundleLinkPositions(){const t=new Map,e=this.groupJunctionsByProximity(),o=new Map;e.forEach(((t,e)=>{t.forEach((t=>{o.set(t.id,t)}))})),this.links.forEach((e=>{if(!e.id.includes("bundle-link")||!e.sankey)return;const o=e.sankey,n=o.getImage();n&&(t.has(n)||t.set(n,[]),t.get(n).push({link:e,sankey:o}))})),t.forEach(((t,e)=>{if(t.length<=1){const{link:o,sankey:n}=t[0];n.dotsAreSource()?(o.target.x=e.position.x,o.target.y=e.position.y):(o.source.x=e.position.x,o.source.y=e.position.y)}else this.distributeImageLinkEndpoints(e,t)})),e.forEach(((t,e)=>{if(t.length<=1)t.forEach((t=>{const e=this.links.find((e=>e.id===`${t.id}-bundle-link`));if(!e)return;const o=t.getJunctionCenter();t.dotsAreSource()?(e.source.x=o.x,e.source.y=o.y):(e.target.x=o.x,e.target.y=o.y)}));else{const e=[];if(t.forEach((t=>{const o=this.links.find((e=>e.id===`${t.id}-bundle-link`));o&&e.push({link:o,sankey:t})})),0===e.length)return;let o=0,n=0;t.forEach((t=>{t.isVertical()?o++:n++}));const i=o>=n,r=this.sortSankeysByDotPositions(e,i),a=r.reduce(((t,{sankey:e})=>t+e.totalThickness),0),s=r[0].sankey.getJunctionCenter();let c=i?s.x:s.y;c-=a/2;const l=i?s.y:s.x;let u=c;r.forEach((({link:t,sankey:e})=>{const o=e.totalThickness,n=u+o/2;if(e.dotsAreSource()){const e=t.source;e.x=i?n:l,e.y=i?l:n}else{const e=t.target;e.x=i?n:l,e.y=i?l:n}u+=o}))}}))}calculateSankeySpatialWeight(t,e){let o=0;if("image"===t.source.type&&t.source.offset?o=e?t.source.offset.x||0:t.source.offset.y||0:"image"===t.target.type&&t.target.offset&&(o=e?t.target.offset.x||0:t.target.offset.y||0),0!==o)return o;const n=t.getDotsForLinks();return 0===n.length?0:n.reduce(((t,o)=>t+(e?o.x||0:o.y||0)),0)/n.length}sortSankeysByDotPositions(t,e){const o=new Map;return t.forEach((({sankey:t})=>{if(!o.has(t)){const n=this.calculateSankeySpatialWeight(t,e);o.set(t,n)}})),[...t].sort(((t,e)=>(o.get(t.sankey)||0)-(o.get(e.sankey)||0)))}distributeImageLinkEndpoints(t,e){if(e.length<=1)return;const o=e.reduce(((t,{sankey:e})=>t+e.totalThickness),0),n=t.position;let i=0,r=0;this.activeSankeys().forEach((t=>{t.isVertical()?i++:r++}));const a=i>=r,s=this.sortSankeysByDotPositions(e,a);let c=a?n.x:n.y;c-=o/2;let l=c;s.forEach((({link:t,sankey:e})=>{const o=e.totalThickness,i=l+o/2,r=e.getJunctionCenter();e.dotsAreSource()?(t.source.x=r.x,t.source.y=r.y,a?(t.target.x=i,t.target.y=n.y):(t.target.x=n.x,t.target.y=i)):(a?(t.source.x=i,t.source.y=n.y):(t.source.x=n.x,t.source.y=i),t.target.x=r.x,t.target.y=r.y),l+=o}))}reorderLinksByDotPositions(){if(!i.state.displayData.length)return;const t=[],e=new Set,o=new Map;this.activeSankeys().forEach((t=>{const e=t.getImage();e&&(o.has(e)||o.set(e,[]),o.get(e).push(t))}));let n=0,r=0;this.activeSankeys().forEach((t=>{t.isVertical()?n++:r++}));const a=n>=r;o.forEach(((t,e)=>{if(t.length<=1)return;const n=this.sortSankeysByDotPositions(t.map((t=>({link:{},sankey:t}))),a).map((t=>t.sankey));o.set(e,n)}));const s=[];o.forEach((t=>{t.forEach((t=>{s.includes(t)||s.push(t)}))})),this.activeSankeys().forEach((t=>{s.includes(t)||s.push(t)})),s.forEach((o=>{this.sortDotsByPosition(o.getDotsForLinks(),o.orientation).forEach(((n,i)=>{const r=o.getLinksForDot(n);0!==r.length&&r.forEach((o=>{t.push(o),e.add(o.id)}))}));const n=this.links.find((t=>t.id===`${o.id}-bundle-link`));n&&!e.has(n.id)&&(t.push(n),e.add(n.id))})),this.links.forEach((o=>{e.has(o.id)||t.push(o)})),this.links=t}updateLinkPositions(){this.reorderLinksByDotPositions(),this.links.forEach((t=>{if(t.id.includes("bundle"))return;if(!t.sankey)return;if(!t.dot)return;const e=t.dot;if(!i.state.displayData.find((t=>t.id===e.id))&&!i.state.superdots.find((t=>t.id===e.id)))return void console.warn(`Dot ${e.id} not found in DOM for link ${t.id}`);const o=t.source.dot===t.dot?t.source:t.target,n=t.sankey.isHorizontal(),r=this.calculateDotConnectionOffset(t.dot,t.sankey);o.x=(t.dot.x||0)+(n?0:r),o.y=(t.dot.y||0)+(n?r:0)}))}getOrCreateColoredMarker(t){const e=`offset-arrow-${t.replace(/[^a-zA-Z0-9]/g,"-")}`;if(!document.getElementById(e)){const o=document.querySelector("svg");let i=o.querySelector("defs");i||(i=document.createElementNS("http://www.w3.org/2000/svg","defs"),o.appendChild(i)),n.select(i).append("marker").attr("id",e).attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill",t).attr("stroke","none")}return e}createOffsetArrows(){this.svgLinkGroup&&(this.svgLinkGroup.selectAll("path.offset-arrow-path").remove(),this.svgLinkGroup.selectAll("path.link").filter((t=>{const e=t.sankey?.flowConfig;return"arrow"===e?.style||void 0!==e?.arrowStyle||void 0!==e?.groupArrowStyles||void 0!==e?.junctionArrowStyle})).each(((t,e,o)=>{const n=o[e],i=t.sankey;if(!i||!i.flowConfig)return;const r=t.id.includes("bundle-link"),a=this.getArrowStyle(i,t,r);let s=this.calculateOffsetPath(n,a.offset||8,a.trimStart||0,a.trimEnd||1);s=this.trimPathEnd(s,.5),t.offsetArrowPath=s;const c=a.color||i.color,l=a.headColor||c,u=this.getOrCreateColoredMarker(l);this.svgLinkGroup.append("path").attr("class",`offset-arrow-path sankey-${i.id}`).attr("d",s).attr("stroke",c).attr("stroke-width",a.width||4).style("opacity",a.opacity||1).attr("marker-end",`url(#${u})`).lower()})),this.svgLinkGroup.selectAll("path.link").raise())}ensureLinkVisibility(){try{this.svgLinkGroup?.selectAll(".link").style("display","block").style("visibility","visible"),this.svgLinkGroup?.selectAll(".offset-arrow-path").style("display","block").style("visibility","visible")}catch(t){console.warn("Error ensuring link visibility:",t)}}getLinks(){return this.links}}},114:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.initVisualization=function(t){const e=n.select(`#${t}`).append("svg").attr("width",r.state.svgWidth).attr("height",r.state.svgHeight),o=e.append("defs");o.append("marker").attr("id","offset-arrow").attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#00c000").attr("stroke","none");const i=o.append("marker").attr("id","animated-flow").attr("viewBox","0 0 40 10").attr("refX",20).attr("refY",5).attr("markerWidth",20).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","userSpaceOnUse");return i.append("path").attr("d","M0,5L40,5").attr("class","flow-path"),i.append("circle").attr("cx",5).attr("cy",5).attr("r",1.5).attr("class","flow-circle flow-circle-1"),i.append("circle").attr("cx",15).attr("cy",5).attr("r",1.5).attr("class","flow-circle flow-circle-2"),i.append("circle").attr("cx",25).attr("cy",5).attr("r",1.5).attr("class","flow-circle flow-circle-3"),i.append("circle").attr("cx",35).attr("cy",5).attr("r",1.5).attr("class","flow-circle flow-circle-4"),r.state.svgGroups.rearAnnotationsGroup=e.append("g").attr("class","rear-annotations"),r.state.svgGroups.linksGroup=e.append("g").attr("class","links"),r.state.svgGroups.dotsGroup=e.append("g").attr("class","dots"),r.state.svgGroups.imgGroup=e.append("g").attr("class","images"),r.state.svgGroups.frontAnnotationsGroup=e.append("g").attr("class","front-annotations"),r.state.svgGroups.dotsGroup&&(r.state.svgGroups.linksGroup?.lower(),r.state.svgGroups.dotsGroup.selectAll("circle.superdot").lower(),r.state.svgGroups.dotsGroup.selectAll("circle:not(.superdot)").raise()),r.state.svg=e,e.selectAll("circle").data(r.state.displayData.slice(1)).enter().append("circle").attr("r",r.state.dotRadius).attr("fill",(function(t){return t.primaryGroup.color||"#000"})),e.on("pointermove",u.pointerMoveHandler),e.on("pointerout",u.pointerOutHandler),h=r.state.linkManager=new a.LinkManager,h&&h.ensureLinkVisibility(),e.on("transitionend",(function(){h&&h.ensureLinkVisibility()})),e},e.cleanupVisualization=function(t){t&&h&&h.clearAll()},e.renderView=function(t){if(!r.state.svgGroups.dotsGroup)return;r.state.dotRadius=t.dotRadius;const e=t.clumps.filter((t=>!0===t.superdot)),o=(t.clumps.filter((t=>!0!==t.superdot)),r.state.displayData.slice(1).filter((t=>!(0,s.isSuperdot)(t))));r.state.svgGroups.dotsGroup.selectAll("circle:not(.superdot)").data(o,(t=>t.id)).join((t=>t.append("circle").attr("r",0).attr("fill",(t=>p(t))).style("opacity",0).transition("voter-circles").duration(300).attr("r",r.state.dotRadius).style("opacity",(t=>null!=t.activeClump?.render?.opacity?t.activeClump.render.opacity:1))),(t=>t.transition("voter-circles").duration(300).attr("fill",(t=>p(t))).attr("r",r.state.dotRadius).style("opacity",(t=>null!=t.activeClump?.render?.opacity?t.activeClump.render.opacity:1))),(t=>t.transition("voter-circles").duration(300).style("opacity",0).remove()));const n=(0,s.createSuperdots)(e);(0,s.renderSuperdots)(n),t.sankeyGroups&&t.sankeyGroups.forEach((t=>{if(t.offset){const e=t.sankey;"image"===e.source.type?(!e.source._originalOffset&&e.source.offset&&(e.source._originalOffset={...e.source.offset}),e.source.offset=t.offset):"image"===e.target.type&&(!e.target._originalOffset&&e.target.offset&&(e.target._originalOffset={...e.target.offset}),e.target.offset=t.offset)}else{const e=t.sankey;"image"===e.source.type&&e.source._originalOffset?e.source.offset=e.source._originalOffset:"image"===e.target.type&&e.target._originalOffset&&(e.target.offset=e.target._originalOffset)}})),h?.setVisibleSankeys(t.sankeyGroups?.map((t=>t.sankey))||[]);const i=[];if(t.sankeyGroups?.forEach((t=>{const e=t.sankey.getImage();e&&i.push(e)})),t.images){const e=r.state.images.filter((t=>t.active));t.images.forEach((t=>{t.position?t.image.position=t.position:t.image.resetPosition(),t.size?t.image.size=t.size:t.image.resetSize(),t.offset?(t.image._originalOffset||(t.image._originalOffset={...t.image.offset}),t.image.offset=t.offset):t.image._originalOffset&&(t.image.offset=t.image._originalOffset),r.state.images.includes(t.image)||r.state.images.push(t.image),e.includes(t.image)||t.image.show()}))}r.state.images.forEach((e=>{t.images?.some((t=>t.image===e))||i.includes(e)||e.hide()})),(0,c.setTextForView)(t),(0,l.renderSvgAnnotations)(t)},e.renderAnnotations=function(){const t=i.annotationCallout,e=(n.timeParse("%d-%b-%y"),n.timeFormat("%d-%b-%y"),n.scaleTime().range([0,800]),n.scaleLinear().range([300,0]),i.annotation().editMode(!0).notePadding(15).type(t).annotations([{note:{label:"Longer text to show text wrapping",bgPadding:{top:15,left:10,right:10,bottom:10},title:"Annotations :)"},data:{date:"18-Sep-09",close:185.02},className:"show-bg",dy:137,dx:162}]));n.select("svg").append("g").attr("class","annotation-group").call(e)},e.ticked=function(){try{if(r.state.isStopped)return;r.state.svgGroups.dotsGroup?.selectAll("circle:not(.superdot)").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),r.state.superdots.length>0&&r.state.view&&(r.state.view&&r.state.view.clumps.filter((t=>!0===t.superdot)).forEach((t=>{let e=0,o=0,n=0;if(r.state.displayData.forEach((i=>{i.activeClump===t&&(e+=i.x||0,o+=i.y||0,n++)})),n>0){const i=e/n,a=o/n;r.state.superdots.find((e=>e.id===(0,s.superdotIDForClump)(t)))&&(0,s.updateSuperdot)(i,a,t)}}))),h?.tick(),(0,c.updateTextPositions)(),(0,l.updateSvgAnnotationPositions)(),document.getElementById("simulation-info").innerHTML=`\n            <div>Alpha: ${r.state.simulation.alpha().toFixed(2)}</div>\n            <div>Dots: ${r.state.displayData.length}</div>\n            <div>Links: ${h?.getLinks().length}</div>\n            <div>Superdots: ${r.state.superdots.length}</div>\n            <div>Status: ${r.state.isStopped?"STOPPED":"Running"}</div>\n        `}catch(t){console.warn(`Error in tick function: ${t}`)}},e.calculateGroupCenters=d,e.getColorForDot=p,e.calculateClumpGroupCenters=function(t){const e=[],o=d(t.map((t=>t.group)));return t.forEach(((t,n)=>{const i=t.group,r=o.get(i);r&&e.push({groupIndex:n,x:r.x,y:r.y})})),e};const n=window.d3,i=window.d3Annotation||(window.d3.annotation=window.d3.annotation||o(948)),r=o(569),a=o(185),s=o(160),c=o(297),l=o(734),u=o(795);let h=null;function d(t){const e=new Map;return t.forEach((t=>{let o=0,n=0,i=0;r.state.displayData.forEach((e=>{t.shouldIncludeDot(e)&&(o+=e.x||0,n+=e.y||0,i++)})),i>0&&e.set(t,{x:o/i,y:n/i})})),e}function p(t){if(t.activeClump?.groupColorOverride){const e=new Map;if(t.activeClump?.groupColorOverride.forEach((t=>{t.group.types.forEach((o=>{e.set(o,t.color)}))})),e.has(t.type))return e.get(t.type)||"#000"}return t.type.color||"#000"}},3:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Sankey=void 0;const n=window.d3,i=o(613),r=o(114),a=o(160),s=o(569);e.Sankey=class{id;description;orientation;totalThickness;color;source;target;active;flowConfig;constructor(t){this.id=t.id,this.description=t.description,this.orientation=t.orientation||"vertical",this.totalThickness=t.totalThickness,this.color=t.color||"rgba(255, 80, 176, 0.4)",this.source=t.source,this.target=t.target,this.active=t.active||!1,this.flowConfig=t.flowConfig||{style:"normal",animated:!1},this.validEndpoints()||console.error(`Sankey '${this.id}' has invalid configuration`)}getImage(){return"image"===this.source.type?this.source.image:"image"===this.target.type?this.target.image:void 0}getImageOffset(){return"image"===this.source.type?this.source.offset||{x:0,y:0}:"image"===this.target.type?this.target.offset||{x:0,y:0}:void 0}getJunctionCenter(){const t=this.getImage();if(!t)return{x:0,y:0};const e=this.getImageOffset()||{x:0,y:0};return{x:t.position.x+e.x,y:t.position.y+e.y}}getEndpointPositions(){let t={x:0,y:0},e={x:0,y:0};if("position"===this.source.type&&this.source.position&&(t=this.source.position),"position"===this.target.type&&this.target.position&&(e=this.target.position),"groups"===this.source.type){const e=this.source.groups;if(e){const o=e.map((t=>t.group)),n=i.VoterGroup.fromGroups(o),a=(0,r.calculateGroupCenters)([n]).get(n);a&&(t={x:a.x,y:a.y})}}if("groups"===this.target.type){const t=this.target.groups;if(t){const o=t.map((t=>t.group)),n=i.VoterGroup.fromGroups(o),a=(0,r.calculateGroupCenters)([n]).get(n);a&&(e={x:a.x,y:a.y})}}if("image"===this.source.type){const e=this.source.image,o=this.source.offset||{x:0,y:0};e&&(t={x:e.position.x+o.x,y:e.position.y+o.y})}if("image"===this.target.type){const t=this.target.image,o=this.target.offset||{x:0,y:0};t&&(e={x:t.position.x+o.x,y:t.position.y+o.y})}return{start:t,end:e}}getWeightedGroups(){return"groups"===this.source.type?this.source.groups:"groups"===this.target.type?this.target.groups:void 0}isHorizontal(){return"horizontal"===this.orientation}isVertical(){return"vertical"===this.orientation}linkThickness(t){const e=this.getWeightedGroups();if(!e)return 0;let o=[];if(e.forEach((e=>{if(e.useSuperdot){const n=(0,a.getSuperdotByGroup)(e.group);n&&(0,a.isSuperdot)(t)&&n===t&&o.push(e)}e.group.containsType(t.type)&&o.push(e)})),0==o.length)return 0;const n=(0,a.isSuperdot)(t)?1:o[0].group.dotCount,i=o.reduce(((t,e)=>t+e.percentage),0);return this.totalThickness*i/n}dotsAreSource(){return"groups"===this.source.type}dotsAreTarget(){return"groups"===this.target.type}isDotsToImage(){return"groups"===this.source.type&&"image"===this.target.type}isImageToDots(){return"image"===this.source.type&&"groups"===this.target.type}getLinks(){return s.state.linkManager?.getLinks().filter((t=>t.id.startsWith(`${this.id}-`)||t.id.startsWith(`${this.id}-bundle-`)))||[]}getLinksForDot(t){return this.getLinks().filter((e=>e.source.dot?.id===t.id||e.target.dot?.id===t.id))}ownsLink(t){return t.id.startsWith(`${this.id}-`)||t.id.startsWith(`${this.id}-bundle-`)}getPositionFromSuperdotToJunction(t,e=.5){let o=[],i="target";if("groups"===this.target.type&&this.target.groups&&(o=this.target.groups.filter((e=>e.group.id===t||e.group.name===t))),0===o.length&&"groups"===this.source.type&&this.source.groups&&(o=this.source.groups.filter((e=>e.group.id===t||e.group.name===t)),"source"),0===o.length)return console.warn(`Sankey '${this.id}' could not find group '${t}'`),this.getJunctionCenter();o.length>1&&console.warn(`Sankey '${this.id}' found multiple groups with ID '${t}'`);const r=o[0].group,s=(0,a.getSuperdotByGroup)(r);if(s){const o=this.getLinksForDot(s);if(o.length>0){const i=o[0],r=n.select(`#${i.id}`);if(r.empty())return console.warn(`Sankey '${this.id}' found superdot for group '${t}' but no link element`),this.getJunctionCenter();const a=r.node();if(a){const t=a.getTotalLength(),o=a.getPointAtLength(t*e);return{x:o.x,y:o.y}}}return console.warn(`Sankey '${this.id}' found superdot for group '${t}' but no links`),this.getJunctionCenter()}return console.warn(`Sankey '${this.id}' found group '${t}' but no superdot`),{x:0,y:0}}getAllDots(){const t=this.getWeightedGroups();return t?s.state.displayData.filter((e=>e.type.belongsInGroups(t.map((t=>t.group))))):[]}getDotsForLinks(){const t=this.getWeightedGroups();if(!t)return[];const e=t.filter((t=>t.useSuperdot));if(e.length){const o=t.filter((t=>!t.useSuperdot)),n=[];return n.push(...i.VoterGroup.activeDots(o.map((t=>t.group)))),e.forEach((t=>{const e=(0,a.getSuperdotByGroup)(t.group);e?n.includes(e)||n.push(e):n.push(...i.VoterGroup.activeDots([t.group]))})),n}return this.getAllDots()}flowForDots(){return this.dotsAreSource()?"outgoing":this.dotsAreTarget()?"incoming":void 0}removeFromDotData(){this.getAllDots().forEach((t=>t.sankeys.delete(this)))}addToDotData(){const t=this.getAllDots(),e=this.flowForDots();e&&t.forEach((t=>t.sankeys.set(this,e)))}allSankeysInSameDirectionForDot(t){return Array.from(t.sankeys.entries()).filter((([t,e])=>e===this.flowForDots())).map((([t])=>t))}validEndpoints(){return this.isDotsToImage()&&this.isImageToDots()?(console.warn(`Sankey '${this.id}' has unsupported configuration: links between dot groups are not yet implemented`),!1):!(!this.dotsAreSource()&&!this.dotsAreTarget()&&(console.warn(`Sankey '${this.id}' has unsupported configuration: at least one endpoint must be a group of dots`),1))}}},517:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.initSimulation=function(){(0,s.updateDisplayData)(),r.state.simulation=n.forceSimulation(r.state.displayData).alpha(1).alphaTarget(.1).velocityDecay(.3).on("tick",i.ticked),n.select("body")},e.simulateView=function(t){if(console.log("Simulating"),!t)return void console.error("Error: view undefined!");r.state.dotRadius=t.dotRadius;let e=t.forceStrength?.collide||r.state.dotRadius*a.COLLIDE_DISTANCE_MULT,o=t.forceStrength?.charge||r.state.dotRadius*a.DOT_CHARGE_STRENGTH;t.forceStrength?.chargeMultiplier&&(o*=t.forceStrength.chargeMultiplier),t.forceStrength?.collideMultiplier&&(e*=t.forceStrength.collideMultiplier);const i=t.forceStrength?.standard||a.GROUPED_FORCE_STRENGTH,s=t.forceStrength?.radial||a.RADIAL_STRENGTH;r.state.simulation.force("x",n.forceX((e=>e.activeClump&&!e.activeClump.force?r.state.svgWidth/2:(0,c.isCustomForce)(e.activeClump?.force)?e.activeClump.force.center?.x??r.state.svgWidth/2:t.center?t.center.x:r.state.svgWidth/2)).strength((t=>t.activeClump&&!t.activeClump.force||(0,c.isCustomForce)(t.activeClump?.force)?i:0))).force("y",n.forceY((e=>e.activeClump&&!e.activeClump.force?r.state.svgHeight/2:(0,c.isCustomForce)(e.activeClump?.force)?e.activeClump.force.center?.y??r.state.svgHeight/2:t.center?t.center.y:r.state.svgHeight/2)).strength((t=>t.activeClump&&!t.activeClump.force||(0,c.isCustomForce)(t.activeClump?.force)?i:0))).force("radial",n.forceRadial((t=>{if((0,c.isRadialForce)(t.activeClump?.force)){t.radialAssignment||=Math.random();const e=t.activeClump.force.boundary;return e.inner+t.radialAssignment*(e.outer-e.inner)}return 0}),t.center?.x||r.state.svgWidth/2,t.center?.y||r.state.svgHeight/2).strength((t=>(0,c.isRadialForce)(t.activeClump?.force)?s:0))),r.state.simulation.force("collide",n.forceCollide(e).iterations(3)).force("charge",n.forceManyBody().strength(((t,e)=>0===e?r.state.dotRadius*a.MOUSE_CHARGE_STRENGTH:o))),r.state.simulation.nodes(r.state.displayData),r.state.simulation.alpha(1).restart()},e.addCursorNode=function(){const t=a.CURSOR_NODE_DATA;r.state.displayData.unshift(t),r.state.cursorNode=t},e.removeCursorNode=function(){r.state.cursorNode&&(r.state.displayData=r.state.displayData.slice(1),r.state.cursorNode=null)};const n=window.d3,i=o(114),r=o(569),a=o(921),s=o(646),c=o(566)},569:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.state=void 0,e.requestView=s;const n=o(517),i=o(114),r=o(921),a=o(646);function s(t){e.state.view?.id!==t.id&&(e.state.upcomingView=t,e.state.viewThrottle||(function(t){const o=e.state.view;if(o&&t!==o&&(0,i.cleanupVisualization)(o),e.state.lockedToAverageYears=t.requireAverageYears||!1,e.state.lockedToAverageYears&&"Average 2016-2022"!==e.state.currentYear)e.state.setYear("Average 2016-2022");else{if(!e.state.lockedToAverageYears){const o=new Set;t.clumps.forEach((t=>{t.ignoreYear||t.group.types.forEach((t=>{const e=Object.keys(r.VOTER_TYPES).find((e=>r.VOTER_TYPES[e].id===t.id));e&&o.add(e)}))}));let n=!0;for(const t of o)if(void 0===e.state.yearData[e.state.currentYear][t]){n=!1;break}if(!n)return console.log(`Current year ${e.state.currentYear} doesn't have data for all types in this view. Switching to Average 2016-2022.`),void e.state.setYear("Average 2016-2022")}e.state.view=t,(0,a.updateDisplayData)(t),(0,i.renderView)(t),(0,n.simulateView)(t),"function"==typeof window.updateYearSelectorUI&&setTimeout(window.updateYearSelectorUI,100)}}(t),e.state.upcomingView=null,e.state.viewThrottle=!0,setTimeout((()=>{e.state.viewThrottle=!1,e.state.upcomingView&&s(e.state.upcomingView)}),600)))}e.state={importedData:[],displayData:[],flattenedData:[],isDistributed:!1,isSeparate:!1,isAutoRadius:!0,outlinesVisible:!1,view:null,dotRadius:2,superdots:[],images:[],svg:null,svgWidth:700,svgHeight:700,simulation:null,cursorNode:null,svgGroups:{},linkManager:null,disableCursorPush:!1,isStopped:!1,upcomingView:null,viewThrottle:!1,currentYear:"Average 2016-2022",availableYears:[],yearData:{},lockedToAverageYears:!1,toggleGrouping(){this.isDistributed=!this.isDistributed},setDisplayData(t){this.displayData=t},setDotRadius(t){this.dotRadius=t},stopSimulation(){this.simulation&&(console.log("Stopping simulation"),this.simulation.alphaTarget(0).stop(),this.isStopped=!0)},resumeSimulation(){this.simulation&&(console.log("Resuming simulation"),this.simulation.alphaTarget(.1).restart(),this.isStopped=!1)},setYear(t){if(this.lockedToAverageYears&&"Average 2016-2022"!==t)console.warn("This view is locked to Average 2016-2022 data");else if(this.yearData[t]){if(this.currentYear=t,Object.keys(r.VOTER_TYPES).forEach((e=>{void 0!==this.yearData[t][e]&&(r.VOTER_TYPES[e].dotCount=this.yearData[t][e])})),Object.keys(r.VOTER_GROUPS).forEach((t=>{r.VOTER_GROUPS[t].updateDotCount()})),e.state.flattenedData=(0,a.flattenData)(Object.values(r.VOTER_TYPES)),this.upcomingView){const t=this.upcomingView;this.upcomingView=null,s(t)}else if(this.view){const t=this.view;this.view=null,s(t)}"function"==typeof window.updateYearSelectorUI&&window.updateYearSelectorUI()}else console.warn(`No data available for year: ${t}`)},yearHasDataForActiveTypes(t){if(!this.view)return!1;const e=new Set,o=new Set;if(this.view.clumps.forEach((t=>{t.ignoreYear&&t.group.types.forEach((t=>{o.add(t.id)}))})),this.displayData.forEach((t=>{t.type.id===r.VOTER_TYPES.SUPERDOT.id||t.type.id===r.VOTER_TYPES.MOUSE.id||o.has(t.type.id)||e.add(t.type.id)})),0===e.size)return!0;for(const o of e){const e=Object.keys(r.VOTER_TYPES).find((t=>r.VOTER_TYPES[t].id===o));if(!e||void 0===this.yearData[t][e])return!1}return!0}}},160:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isSuperdot=function(t){return(0,s.isDotData)(t)&&t.type===r.VOTER_TYPES.SUPERDOT},e.getSuperdotByGroup=function(t){return i.state.superdots.find((e=>e.viewClump.group.containsAllTypesFromGroup(t)))},e.createSuperdots=function(t){if(0===t.length)return[];const e=(0,a.calculateClumpGroupCenters)(t),o=[];return e.forEach((e=>{o.push(c(e,t[e.groupIndex]))})),o},e.createSuperdot=c,e.superdotIDForClump=l,e.superdotIDForGroup=u,e.clearAllSuperdots=function(){i.state.svgGroups.dotsGroup?.selectAll("circle.superdot").transition("superdot-remove").duration(650).ease(n.easePolyInOut).attr("r",0).style("opacity",0).remove(),i.state.svgGroups.dotsGroup?.selectAll("circle.superdot").remove(),i.state.superdots=[]},e.renderSuperdots=function(t){if(!i.state.svgGroups.dotsGroup)return;i.state.svgGroups.dotsGroup.selectAll("circle.superdot").data();const e=i.state.svgGroups.dotsGroup.selectAll("circle.superdot").data(t,(t=>t.id));e.enter().append("circle").attr("class","superdot").attr("id",(t=>t.id)).attr("cx",(t=>isNaN(t.x)?0:t.x)).attr("cy",(t=>isNaN(t.y)?0:t.y)).attr("r",(t=>isNaN(t.radius)?25:t.radius)).attr("fill",(t=>t.fillColor||"rgba(246, 246, 246, 0.95)")).attr("stroke",(t=>t.strokeColor||"#999")).attr("stroke-width",4).style("opacity",1).style("transform-box","fill-box").style("transform-origin","center").style("transform","scale(0.01)").transition("superdot-entry").duration(900).ease(n.easePolyInOut).style("transform","scale(1)"),e.attr("cx",(t=>isNaN(t.x)?0:t.x)).attr("cy",(t=>isNaN(t.y)?0:t.y)).attr("r",(t=>isNaN(t.radius)?25:t.radius)).attr("fill",(t=>t.fillColor||"rgba(246, 246, 246, 0.95)")).attr("stroke",(t=>t.strokeColor||"#999")).lower(),e.exit().transition("superdot-exit").duration(650).ease(n.easePolyInOut).style("transform","scale(0)").style("opacity",0).remove().each((function(t){const e=i.state.superdots.findIndex((e=>e.id===t.id));-1!==e&&i.state.superdots.splice(e,1)}))},e.updateSuperdot=function(t,e,o){try{const n=l(o),r=i.state.svgGroups.dotsGroup?.select(`#${n}`);let a=0;i.state.displayData.forEach((n=>{if(n.activeClump===o){const o=(n.x||0)-t,r=(n.y||0)-e,s=Math.sqrt(o*o+r*r)+i.state.dotRadius;a=Math.max(a,s)}}));const s=Math.max(25,2*i.state.dotRadius);let c=0;i.state.displayData.forEach((t=>{t.activeClump===o&&c++}));let u=1.05;const h=Math.max(s,a*u),d=Math.sqrt(c)*i.state.dotRadius*1.5,p=1.8,f=i.state.superdots.find((t=>t.id===n)),y=p*d;let g;if(f)if(h<y)g=h;else{const t=.1;g=y+(h-y)*Math.exp(-t*(h-y))}else g=h;r&&!r.empty()&&(r.attr("cx",t).attr("cy",e).attr("r",g).attr("stroke-width",4).lower(),f&&(f.x=t,f.y=e,f.radius=g))}catch(t){console.warn(`Error updating superdot: ${t}`)}};const n=window.d3,i=o(569),r=o(921),a=o(114),s=o(566);function c(t,e){const o=i.state.superdots.find((t=>t.id===l(e)));if(o)return o.x=t.x,o.y=t.y,o;let s=0;const c=e;i.state.displayData.forEach((e=>{if(e.activeClump===c){const o=(e.x||0)-t.x,n=(e.y||0)-t.y,r=Math.sqrt(o*o+n*n)+i.state.dotRadius;s=Math.max(s,r)}}));const u=Math.max(25,2*i.state.dotRadius);let h=0;i.state.displayData.forEach((t=>{t.activeClump===c&&h++}));let d=1.05;h>100&&(d=1.03),h>500&&(d=1.02);const p=Math.max(u,s*d);let f=1.8*Math.sqrt(h);h>1e3&&(f=2.2*Math.sqrt(h));const y=Math.max(p,f,u);let g,_="rgba(246, 246, 246, 0.95)";c.groupColorOverride&&c.groupColorOverride?.forEach((t=>{if(t.group.types.includes(r.VOTER_TYPES.SUPERDOT)){const e=n.color(t.color);e&&(_=e.toString(),g=_)}}));let m="#999",x=0,v=0,O=0,w=0;if(i.state.displayData.forEach((t=>{if(t.activeClump===c){const e=n.color((0,a.getColorForDot)(t));if(e){const t=n.rgb(e);x+=t.r,v+=t.g,O+=t.b,w++}}})),w>0){const t=Math.round(x/w),e=Math.round(v/w),o=Math.round(O/w),i=.5;m=n.rgb(Math.min(255,t*(1-i)+255*i),Math.min(255,e*(1-i)+255*i),Math.min(255,o*(1-i)+255*i)).toString()}const b={id:l(c),viewClump:c,x:t.x,y:t.y,type:r.VOTER_TYPES.SUPERDOT,radius:y,fillColor:_,strokeColor:m,sankeys:new Map};return i.state.superdots.push(b),b}function l(t){return u(t.group)}function u(t){return`superdot-${t.typeKey}`}},297:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.setTextForView=function(t){if(!i.state.svgGroups.frontAnnotationsGroup)return;const e=[],o=[],a=d();t.sankeyGroups?.length&&t.sankeyGroups.some((t=>t.textAnnotations?.length))&&t.sankeyGroups.forEach((t=>{const n=t.textAnnotations||[];if(n.length>0){const i=t.sankey;n.forEach((t=>{const n=a?.filter((e=>e.id===t.id));if(n&&n.size()>0)return void o.push(n);const r=t.text||i.id,s=p({target:i,text:r,id:t.id||`text-${i.id}-${r.replace(/\s/g,"-")}`,targetAnchorLink:t.targetAnchorLink||"junction",textAnchor:t.textAnchor||"end",targetOffset:t.targetOffset||{x:0,y:0},classes:["sankey-label"],color:t.color||"green"});s&&e.push(s)}))}})),t.clumps.length&&t.clumps.some((t=>t.textAnnotations?.length))&&t.clumps.forEach((t=>{const n=t.textAnnotations||[];n.length>0&&n.forEach((n=>{const s=n.text||t.group.name;if(t.superdot){const l=i.state.superdots.find((e=>(0,r.sameTypesInClumps)(t,e.viewClump)));if(!l)return void console.error(`Clump ${t.group.name} does not have a corresponding superdot`);const u=a?.filter((t=>t.id===n.id));if(u&&u.size()>0)return void o.push(u);const h=p({target:l,text:s,id:n.id||`text-${t.group.name}-${s.replace(/\s/g,"-")}`,targetAnchorX:n.targetAnchorX||"middle",targetAnchorY:n.targetAnchorY||"middle",textAnchor:n.textAnchor||"middle",targetOffset:n.targetOffset||{x:0,y:0},classes:["superdot-label"],color:n.color||c.typeColors.purple});h&&e.push(h)}else{const i=a?.filter((t=>t.id===n.id));if(i&&i.size()>0)return void o.push(i);const r=p({target:t.group,text:s,id:n.id||`text-${t.group.name}-${s.replace(/\s/g,"-")}`,targetAnchorX:n.targetAnchorX||"middle",targetAnchorY:n.targetAnchorY||"middle",textAnchor:n.textAnchor||"middle",targetOffset:n.targetOffset||{x:0,y:0},classes:["clump-label"],color:n.color||c.typeColors.purple});r&&e.push(r)}}))})),t.textAnnotations?.length&&t.textAnnotations.forEach((t=>{const n=a?.filter((e=>e.id===t.id));if(n&&n.size()>0)return void o.push(n);const i=p(t);i&&e.push(i)})),y();const s=o.map((t=>t.datum().id));a?.filter((t=>!s.includes(t.id))).transition("text-out").duration(500).style("opacity",0).on("end",(function(){n.select(this).remove()}))},e.addText=p,e.updateTextPositions=y;const n=window.d3,i=o(569),r=o(566),a=o(3),s=o(613),c=o(921),l=o(636),u=o(160),h=o(114);function d(){return i.state.svgGroups.frontAnnotationsGroup?i.state.svgGroups.frontAnnotationsGroup.selectAll("text"):null}function p(t){if(!i.state.svgGroups.frontAnnotationsGroup)return null;const e=f(t);t.id=t.id||`text-${t.text.replace(/\s/g,"-")}`;const o=i.state.svgGroups.frontAnnotationsGroup.append("text").attr("id",t.id).attr("class",t.classes?.join(" ")||"").datum(t).attr("x",e.x).attr("y",e.y).text(t.text).attr("text-anchor",t.textAnchor||"middle").style("font-size",t.size||"").style("fill",t.color||"").style("font-family",t.font||"").style("opacity",0);return o.transition(`text-in-${t.id}`).duration(500).style("opacity",1),o}function f(t){let e={x:0,y:0},o={left:0,right:0,top:0,bottom:0},n={start:{x:0,y:0},end:{x:0,y:0}},c={x:0,y:0};if((0,r.isDotData)(t.target)&&!(0,u.isSuperdot)(t.target))e={x:t.target.x||0,y:t.target.y||0},o={left:e.x-i.state.dotRadius,right:e.x+i.state.dotRadius,top:e.y-i.state.dotRadius,bottom:e.y+i.state.dotRadius};else if((0,u.isSuperdot)(t.target))e={x:t.target.x||0,y:t.target.y||0},o={left:e.x-t.target.radius,right:e.x+t.target.radius,top:e.y-t.target.radius,bottom:e.y+t.target.radius};else if(t.target instanceof l.SimImage){const n=t.target.position;e={x:n.x,y:n.y},o={left:e.x-t.target.size.width/2,right:e.x+t.target.size.width/2,top:e.y-t.target.size.height/2,bottom:e.y+t.target.size.height/2}}else t.target instanceof a.Sankey?(e=t.target.getJunctionCenter(),n=t.target.getEndpointPositions()):t.target instanceof s.VoterGroup?e=(0,h.calculateGroupCenters)([t.target]).get(t.target):(e=t.target,o={left:e.x,right:e.x,top:e.y,bottom:e.y});return t.target instanceof a.Sankey?c="start"===t.targetAnchorLink?n.start:"end"===t.targetAnchorLink?n.end:e:("left"===t.targetAnchorX?c.x=o.left:"right"===t.targetAnchorX?c.x=o.right:c.x=e.x,"top"===t.targetAnchorY?c.y=o.top:"bottom"===t.targetAnchorY?c.y=o.bottom:c.y=e.y),{x:c.x+(t.targetOffset?.x||0),y:c.y+(t.targetOffset?.y||0)}}function y(){const t=d();if(t){const e=new Map;t?.each((t=>{e.set(t.id,f(t))})),t.attr("x",(t=>e.get(t.id).x)).attr("y",(t=>e.get(t.id).y))}}},613:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VoterGroup=e.VoterType=void 0,window.d3;const n=o(569);e.VoterType=class{id;name;color;dotCount;constructor(t,e,o){this.id=t,this.name=e,this.color=o,this.dotCount=0}belongsInClump(t){return t.group.containsType(this)}belongsInView(t){return t.clumps.some((t=>this.belongsInClump(t)))}matchedClumpInView(t){return t.clumps.find((t=>this.belongsInClump(t)))}belongsInGroups(t){return t.some((t=>t.containsType(this)))}};class i{types;id;typeKey;name;dotCount;constructor(t,e,o){this.types=t,this.id=e,this.name=o,this.dotCount=this.getDotCount();const n=this.types.slice().sort(((t,e)=>t.id.localeCompare(e.id)));this.typeKey=n.map((t=>t.id.replace(/[^a-zA-Z0-9]/g,"-"))).join("-")}updateDotCount(){this.dotCount=this.getDotCount()}getDotCount(){return this.types.reduce(((t,e)=>t+e.dotCount),0)}containsType(t){return this.types.includes(t)}shouldIncludeDot(t){return this.types.includes(t.type)}belongsInView(t){return t.clumps.some((t=>this.belongsInClump(t)))}belongsInClump(t){return this.types.some((e=>t.group.containsType(e)))}indexInClump(t){return t.group.types.findIndex((e=>t.group.containsType(e)))}sameTypesAs(t){return this.types.length===t.types.length&&this.types.every((e=>t.containsType(e)))}containsAllTypesFromGroup(t){return t.types.every((t=>this.containsType(t)))}activeDots(){return n.state.displayData.filter((t=>this.shouldIncludeDot(t)))}static fromType(t){return new i([t],t.id,t.name)}static fromTypes(t,e,o){return new i(t,e??t.map((t=>t.id)).join("-"),o??t.map((t=>t.name)).join(" + "))}static fromGroups(t,e,o){return new i(t.flatMap((t=>t.types)),e??t.map((t=>t.id)).join("-"),o??t.map((t=>t.name)).join(" + "))}static activeDots(t){const e=[];return t.forEach((t=>e.push(...t.activeDots()))),e}}e.VoterGroup=i},566:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.forceType=a,e.isCustomForce=function(t){return"custom"===a(t)},e.isRadialForce=function(t){return"radial"===a(t)},e.isDotData=function(t){return t&&t.id&&t.type&&t.type instanceof i.VoterType},e.sameTypesInClumps=function(t,e){return t.group.sameTypesAs(e.group)},e.getDotInfo=function(t){const e=document.querySelector("svg"),[o,i]=n.pointer(t,e),a=n.select(e).selectAll("circle").filter((function(){const t=parseFloat(this.getAttribute("cx")||"0"),e=parseFloat(this.getAttribute("cy")||"0"),n=parseFloat(this.getAttribute("r")||"0");return Math.sqrt((o-t)**2+(i-e)**2)<=n})).node();if(a){const t=n.select(a).datum();let e;return e=-1!==t.id.indexOf("superdot")?t.fillColor:t.type.color,n.select(a).attr("fill","red"),setTimeout((()=>{n.select(a).attr("fill",e)}),1e3),`ID: ${t.id}<br />\n                Type: ${t.type.name}<br />\n                Clump: ${t.type.matchedClumpInView(r.state.view)?.group.name}<br />\n                Sankeys: ${t.sankeys.size}<br />`}return"No circle found"};const n=window.d3,i=o(613),r=o(569);function a(t){return t?void 0===t.type||"custom"===t.type?"custom":t.type:null}},306:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.viewPresets=void 0,e.initializeViewComponents=function(){(function(){const t={partyIcon:new r.SimImage({id:"bot-party-icon",src:"assets/img/parties-icon-v03.svg",alt:"Political party icon",position:{x:350,y:500},size:{width:100,height:100}}),parliamentIcon:new r.SimImage({id:"parliament-icon-end",src:"assets/img/parliament-v01.svg",alt:"Parliament icon",position:{x:250,y:100},size:{width:600,height:200}})},e=Object.values(t).map((t=>t.id));if(new Set(e).size!==e.length)throw new Error("Duplicate image IDs found");for(const e in t){const o=t[e];c[e]=o}})(),function(){const t={canadianSuperdotToParties:new a.Sankey({id:"canadian-superdot-to-parties",description:"Flow from all eligible Canadian voters to parties",totalThickness:100,color:"rgba(0, 255, 30, 0.3)",orientation:"horizontal",source:{type:"groups",groups:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,percentage:1,useSuperdot:!0}]},target:{type:"image",image:c.partyIcon,offset:{x:-200,y:0},position:{x:600,y:500}},flowConfig:{style:"dashed",arrowPosition:"end",animated:!0,dashed:!0,arrowStyle:{offset:15,color:"#00c000",headColor:"#00c000",trimStart:.1,trimEnd:.9,opacity:1,width:4},groupArrowStyles:{[n.VOTER_GROUPS.ALL_ELIGIBLE.id]:{offset:{x:0,y:30},trimStart:.4,trimEnd:.9}},junctionArrowStyle:{offset:{x:0,y:30},color:"#00c000",headColor:"#00c000",trimStart:0,trimEnd:.6,width:5}}}),parliamentToCanadianSuperdot:new a.Sankey({id:"parliament-to-canadian-superdot",description:"Flow from all eligible Canadian voters",totalThickness:45,color:"rgba(0, 106, 255, 0.3)",orientation:"horizontal",source:{type:"image",image:c.parliamentIcon,offset:{x:-120,y:0},position:{x:500,y:100}},target:{type:"groups",groups:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,percentage:1,useSuperdot:!0}]},flowConfig:{style:"dashed",animated:!0}}),votersAndDonorsSuperdotToParties:new a.Sankey({id:"voter-donor-superdot-to-parties",description:"Flow from all eligible Canadian voters to parties",totalThickness:45,color:"rgba(0, 255, 30, 0.3)",orientation:"vertical",source:{type:"groups",groups:[{group:n.VOTER_GROUPS.ALL_VOTERS,percentage:1,useSuperdot:!0}]},target:{type:"image",image:c.partyIcon,offset:{x:0,y:-50}},flowConfig:{style:"dashed",animated:!0}}),parliamentToVotersAndDonorsSuperdot:new a.Sankey({id:"parliament-to-voter-donor-superdot",description:"Flow from all eligible Canadian voters",totalThickness:45,color:"rgba(0, 106, 255, 0.3)",orientation:"vertical",source:{type:"image",image:c.parliamentIcon,offset:{x:0,y:100}},target:{type:"groups",groups:[{group:n.VOTER_GROUPS.ALL_VOTERS,percentage:1,useSuperdot:!0}]},flowConfig:{style:"dashed",animated:!0}}),votersToParty:new a.Sankey({id:"voters-to-party",description:"Flow from all voters to parties",totalThickness:100,color:"rgba(0, 255, 30, 0.3)",source:{type:"groups",groups:[{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,percentage:1}]},target:{type:"image",image:c.partyIcon,offset:{x:0,y:-100}},flowConfig:{style:"arrow",arrowPosition:"end",animated:!0,dashed:!0,arrowStyle:{offset:12,color:"rgba(0, 106, 255, 0.8)",headColor:"#006aff",trimStart:.4,trimEnd:.6,opacity:.8,width:4},junctionArrowStyle:{offset:{x:5,y:-10},color:"rgba(0, 130, 255, 0.9)",headColor:"#0055dd",trimStart:.3,trimEnd:.7,width:3,opacity:.85}}}),donorsToParty:new a.Sankey({id:"donors-to-party",description:"Flow from donors to parties",totalThickness:50,color:"rgba(0, 255, 30, 0.3)",source:{type:"groups",groups:[{group:n.VOTER_GROUPS.DONORS_1_199,percentage:.1,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_200_499,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_500_999,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_OVER_1000,percentage:.5,useSuperdot:!0}]},target:{type:"image",image:c.partyIcon,offset:{x:0,y:-100}},flowConfig:{style:"dashed",arrowPosition:"end",arrowStyle:{offset:-20,color:"green",headColor:"green",trimStart:.2,trimEnd:.8,opacity:1,width:4},groupArrowStyles:{[n.VOTER_GROUPS.DONORS_1_199.id]:{offset:{x:-30,y:0},trimStart:.4},[n.VOTER_GROUPS.DONORS_200_499.id]:{offset:{x:16,y:0},trimStart:.2,trimEnd:.5},[n.VOTER_GROUPS.DONORS_500_999.id]:{offset:{x:16,y:0},trimStart:.2,trimEnd:.7},[n.VOTER_GROUPS.DONORS_OVER_1000.id]:{offset:{x:30,y:20},color:"gold",headColor:"gold",trimStart:.1,trimEnd:1},[n.VOTER_GROUPS.DONORS_1_999.id]:{offset:{x:-50,y:0},opacity:.2,trimStart:.4}},junctionArrowStyle:{offset:{x:0,y:-40},color:"rgba(0, 150, 0, 0.7)",headColor:"#008800",trimStart:.5,trimEnd:.7,width:6,opacity:.8}}}),donorsToPartySubsidized:new a.Sankey({id:"donors-to-party-subsidized",description:"Portion of flow from donors to parties that is subsidized",totalThickness:20,color:"rgba(0, 106, 255, 0.3)",source:{type:"groups",groups:[{group:n.VOTER_GROUPS.DONORS_1_199,percentage:.1,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_200_499,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_500_999,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_OVER_1000,percentage:.5,useSuperdot:!0}]},target:{type:"image",image:c.partyIcon,offset:{x:0,y:-100}},flowConfig:{style:"dashed"}}),donorsToPartyOOP:new a.Sankey({id:"donors-to-party-out-of-pocket",description:"Portion of flow from donors to parties that is out-of-pocket",totalThickness:30,color:"rgba(0, 255, 30, 0.3)",source:{type:"groups",groups:[{group:n.VOTER_GROUPS.DONORS_1_199,percentage:.1,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_200_499,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_500_999,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_OVER_1000,percentage:.5,useSuperdot:!0}]},target:{type:"image",image:c.partyIcon,offset:{x:0,y:-100}},flowConfig:{style:"dashed"}}),parliamentToDonors:new a.Sankey({id:"parliament-to-donors",description:"Flow from parliament to donors",totalThickness:20,color:"rgba(0, 106, 255, 0.3)",source:{type:"image",image:c.parliamentIcon,offset:{x:0,y:150}},target:{type:"groups",groups:[{group:n.VOTER_GROUPS.DONORS_1_199,percentage:.1,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_200_499,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_500_999,percentage:.2,useSuperdot:!0},{group:n.VOTER_GROUPS.DONORS_OVER_1000,percentage:.5,useSuperdot:!0}]},flowConfig:{style:"dashed"}}),parliamentToVoters:new a.Sankey({id:"parliament-to-voters",description:"Flow from parliament to all voters",totalThickness:100,color:"rgba(0, 106, 255, 0.3)",source:{type:"image",image:c.parliamentIcon,offset:{x:0,y:150}},target:{type:"groups",groups:[{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,percentage:1}]}})},e=Object.values(t).map((t=>t.id));if(new Set(e).size!==e.length)throw new Error("Duplicate sankey IDs found");for(const e in t){const o=t[e];l[e]=o}}(),function(){const t={everyoneCloud:{description:"Everyone in a single big cloud",dotRadius:3,forceStrength:{charge:-1.5,collide:3},clumps:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,force:{center:s()}}]},lotOfMoneyFromCanadians:{description:"A lot of money from Canadians",dotRadius:1,forceStrength:{charge:-.2},clumps:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,superdot:!0,textAnnotations:[{text:"Eligible Voters",targetAnchorY:"top",targetOffset:{x:0,y:-20}}],force:{center:{x:100,y:s().y}}}],sankeyGroups:[{sankey:l.canadianSuperdotToParties,textAnnotations:[{text:"$50 Million",targetOffset:{x:80,y:5},targetAnchorLink:"junction"}],svgAnnotations:[{type:"callout",targetAnchorLink:"superdot-link",targetFlowGroup:n.VOTER_GROUPS.ALL_ELIGIBLE.id,fixedPosition:{x:s().x+30,y:s().y-90},targetFlowRatio:.6,dx:0,dy:-80,note:{title:"Individual Donations",label:"This represents the flow of financial contributions",bgPadding:10,wrap:200,align:"middle"},connector:{type:"elbow"},className:"sankey-annotation green-flow-annotation"}]}],svgAnnotations:[{id:"political-parties-explanation",type:"callout",target:c.partyIcon,targetOffset:{x:-10,y:-40},fixedPosition:{x:s().x+70,y:s().y+30},note:{title:"Federal Political Parties",wrap:350,bgPadding:10,align:"left"},connector:{type:"elbow"},subject:{radiusPadding:0},className:"circle-annotation political-parties-initial"}]},govtIsPayingThemToDoSo:{description:"And the government is paying them to do so",dotRadius:1,requireAverageYears:!0,forceStrength:{charge:-.2},images:[{image:c.partyIcon,position:{x:650,y:s().y+130}},{image:c.parliamentIcon,position:{x:60,y:s().y+0}}],clumps:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,superdot:!0,textAnnotations:[{text:"Eligible Voters",targetAnchorY:"top",targetOffset:{x:0,y:-20}}],force:{center:{x:350,y:s().y}}}],sankeyGroups:[{sankey:l.canadianSuperdotToParties,offset:{x:0,y:0},textAnnotations:[{text:"$50 Million",targetOffset:{x:-50,y:-70},targetAnchorLink:"end"}]},{sankey:l.parliamentToCanadianSuperdot,offset:{x:0,y:0},textAnnotations:[{text:"$XX Million",targetOffset:{x:160,y:10},targetAnchorLink:"start",color:"#2F4BD8"}],svgAnnotations:[{type:"callout",targetAnchorLink:"superdot-link",targetFlowGroup:n.VOTER_GROUPS.ALL_ELIGIBLE.id,fixedPosition:{x:s().x-180,y:s().y-190},targetOffset:{x:0,y:-15},targetFlowRatio:.2,dx:0,dy:-80,note:{title:"Tax credits",label:"Public money given back to donors through the Federal Political Contributions Tax Credit",bgPadding:10,wrap:250,align:"middle"},connector:{type:"elbow"},className:"sankey-annotation blue-flow-annotation"}]}],textAnnotations:[{text:"Political Parties",target:c.partyIcon,targetOffset:{x:0,y:40},targetAnchorY:"bottom",classes:["parties-label"]}]},allThatMoney:{description:"Where is all that money going?",dotRadius:2,forceStrength:{charge:-1},images:[{image:c.parliamentIcon,position:{x:60,y:s().y+0}}],clumps:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,superdot:!0,textAnnotations:[],force:{center:{x:500,y:s().y}}}],sankeyGroups:[{sankey:l.parliamentToCanadianSuperdot,offset:{x:0,y:0},textAnnotations:[{text:"$XX Million",targetOffset:{x:160,y:10},targetAnchorLink:"start",color:"#2F4BD8"}]}],textAnnotations:[]},everyoneRadial:{description:"Everyone mixed in a single big radial",dotRadius:2,forceStrength:{charge:-3,collide:3},clumps:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,force:{type:"radial",boundary:{inner:0,outer:1500}}}]},allVotersCloud:{description:"All Voters in a single cloud, with non-voters orbiting paler",dotRadius:3,forceStrength:{charge:-2},clumps:[{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:180,outer:400}},render:{opacity:.9}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,superdot:!0,svgAnnotations:[{id:"voters-annotation",type:"calloutCircle",fixedPosition:{x:50,y:s().y-120},note:{title:"Canadians who vote",wrap:150,bgPadding:10,align:"middle"},connector:{type:"line"},subject:{radiusPadding:0},className:"hidden-circle-annotation purple-annotation"}]}]},onlyVotersBullseye:{description:"Only a fraction donate",dotRadius:4,forceStrength:{charge:-4},clumps:[{group:n.VOTER_GROUPS.ALL_DONORS,superdot:!0,force:{},svgAnnotations:[{id:"all-donors-annotation",type:"calloutCircle",fixedPosition:{x:210,y:s().y-120},note:{title:"Individuals who donate to parties",wrap:250,bgPadding:10,align:"left"},connector:{end:"arrow",type:"elbow"},subject:{radiusPadding:0},className:"hidden-circle-annotation donors-annotation"}]},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:100,outer:500}},ignoreYear:!0,render:{opacity:.5}},{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:100,outer:500}},ignoreYear:!0,render:{opacity:.5}}]},highlightGolds:{description:"and only a few of them can afford to donate big",dotRadius:12,forceStrength:{charge:-12},clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{},svgAnnotations:[{id:"gold-donors-annotation",type:"calloutCircle",fixedPosition:{x:220,y:s().y-120},note:{title:"Gold Donors",label:"These are the elite donors who donate over $1000",wrap:150,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"line"},subject:{radiusPadding:0},className:"hidden-circle-annotation gold-annotation"}]},{group:n.VOTER_GROUPS.DONORS_1_999,force:{type:"radial",boundary:{inner:60,outer:100}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,ignoreYear:!0,force:{type:"radial",boundary:{inner:150,outer:1e3}},render:{opacity:.2}}]},goldProportionOfDonations:{description:"These elite donors are responsible for nearly half of donations to parties",dotRadius:8,forceStrength:{charge:-8},clumps:[{group:n.VOTER_GROUPS.DONORS_1_199,superdot:!0,force:{center:{x:s().x-220,y:s().y-120}},textAnnotations:[{text:"$1-199",color:n.typeColors.blue,targetOffset:{x:0,y:-20},targetAnchorY:"top",targetAnchorX:"middle"}]},{group:n.VOTER_GROUPS.DONORS_200_499,superdot:!0,force:{center:{x:s().x-100,y:s().y-100}},textAnnotations:[{text:"$200-499",color:n.typeColors.teal,targetOffset:{x:0,y:-20},targetAnchorY:"top",targetAnchorX:"middle"}]},{group:n.VOTER_GROUPS.DONORS_500_999,superdot:!0,force:{center:{x:s().x+10,y:s().y-130}},textAnnotations:[{text:"$500-999",color:n.typeColors.cyan,targetOffset:{x:0,y:-20},targetAnchorY:"top",targetAnchorX:"middle"}]},{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{center:{x:s().x+120,y:s().y-100}},textAnnotations:[{text:"$1000+",color:n.typeColors.gold,targetOffset:{x:0,y:-20},targetAnchorY:"top",targetAnchorX:"middle"}]},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:400,outer:1e3}},render:{opacity:.2},ignoreYear:!0}],sankeyGroups:[{sankey:l.donorsToParty,svgAnnotations:[{id:"gold-donors-flow-annotation",type:"callout",target:l.donorsToParty,targetAnchorLink:"superdot-link",targetFlowGroup:"Donors >$1000",targetFlowRatio:.5,fixedPosition:{x:s().x+200,y:s().y+80},note:{title:"Elite Donor Donations",label:"The $1000+ donors account for nearly half of all party donations",wrap:180,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"elbow"},className:"gold-donors-flow-annotation"}]}],textAnnotations:[{text:"Donation Amount:",target:{x:s().x,y:s().y-230},targetOffset:{x:0,y:0},targetAnchorY:"bottom",classes:["donors-label"]}]},partiesFocusingOnWealthy:{description:"Parties are focusing on wealthy donors",dotRadius:8,forceStrength:{charge:-8},clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{center:{x:340,y:s().y-50}}},{group:n.VOTER_GROUPS.DONORS_1_999,superdot:!0,render:{opacity:.5},force:{center:{x:150,y:s().y-150}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:400,outer:1e3}},render:{opacity:.2},ignoreYear:!0}],sankeyGroups:[{sankey:l.donorsToParty}]},moneyBuysAccess:{description:"Money buys access to government",dotRadius:10,forceStrength:{charge:-9},images:[{image:c.partyIcon,position:{x:s().x,y:s().y+10}}],clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000,force:{center:{x:s().x,y:s().y-60}}},{group:n.VOTER_GROUPS.DONORS_1_999,render:{opacity:.7},force:{type:"radial",boundary:{inner:120,outer:200}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:300,outer:1e3}},render:{opacity:.4},ignoreYear:!0}],svgAnnotations:[{id:"elite-donors-annotation",type:"calloutCircle",target:{x:350,y:s().y-10},fixedPosition:{x:120,y:s().y-60},note:{title:"The Inner Circle",label:"Parties host private events for these elite donors",wrap:150,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"line"},subject:{radiusPadding:5,includeElements:[n.VOTER_GROUPS.DONORS_OVER_1000,"bot-party-icon"]},className:"elite-donors-annotation"},{id:"other-donors-annotation",type:"callout",target:{x:340,y:s().y-150},fixedPosition:{x:580,y:s().y-20},note:{title:"On the Outside",label:"So even these donors aren't let into the inner circle",wrap:160,bgPadding:10,align:"middle"},connector:{type:"line"},subject:{radiusPadding:20,includeElements:[n.VOTER_GROUPS.DONORS_1_999]},className:"hidden-line-annotation teal-annotation"}]},exclusiveClub:{description:"The exclusive club of big donors",dotRadius:20,forceStrength:{charge:-18},images:[{image:c.partyIcon,position:{x:s().x,y:s().y+10},size:{width:170,height:170}}],clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000,force:{center:{x:s().x,y:s().y-120}}},{group:n.VOTER_GROUPS.DONORS_1_999,render:{opacity:.3},force:{type:"radial",boundary:{inner:250,outer:300}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:400,outer:2e3}},render:{opacity:.1},ignoreYear:!0}],svgAnnotations:[{id:"elite-donors-annotation",type:"calloutCircle",target:{x:350,y:s().y-10},fixedPosition:{x:120,y:s().y-60},note:{title:"The Inner Circle",label:"Parties host private events for these elite donors",wrap:150,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"line"},subject:{radiusPadding:50,includeElements:[n.VOTER_GROUPS.DONORS_OVER_1000,"bot-party-icon"]},className:"elite-donors-annotation hidden-callout-annotation"}]},outsideLookingIn:{description:"Leaving the rest of us outside looking in",dotRadius:5,forceStrength:{charge:-5},images:[{image:c.partyIcon,position:{x:s().x,y:s().y},size:{width:70,height:70}}],clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000,force:{type:"radial",boundary:{inner:50,outer:50}}},{group:n.VOTER_GROUPS.DONORS_1_999,force:{type:"radial",boundary:{inner:100,outer:130}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:150,outer:300}}}],svgAnnotations:[{id:"elite-donors-annotation",type:"calloutCircle",target:{x:350,y:s().y},fixedPosition:{x:120,y:s().y-60},note:{title:"The Inner Circle",label:"Parties host private events for these elite donors",wrap:150,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"line"},subject:{radiusPadding:10,includeElements:[n.VOTER_GROUPS.DONORS_OVER_1000,"bot-party-icon"]},className:"elite-donors-annotation hidden-callout-annotation"}]},benefitsTheAlreadyWealthySetup:{description:"For those with enough money to buy in...",dotRadius:7,forceStrength:{charge:-7},images:[{image:c.partyIcon,position:{x:350,y:s().y+40},size:{width:70,height:70}},{image:c.parliamentIcon,position:{x:350,y:s().y-140},size:{width:200,height:200}}],clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000,force:{center:{x:s().x,y:s().y-20}}},{group:n.VOTER_GROUPS.DONORS_1_999,render:{opacity:.4},force:{type:"radial",boundary:{inner:250,outer:300}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,render:{opacity:.4},force:{type:"radial",boundary:{inner:300,outer:500}}}]},howTaxCreditWorks:{description:"how tax credits work",dotRadius:7,forceStrength:{},sankeyGroups:[{sankey:l.donorsToParty}],clumps:[{group:n.VOTER_GROUPS.DONORS_1_999,superdot:!0,force:{center:{x:200,y:s().y-150}}},{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{center:{x:450,y:s().y-150}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,render:{opacity:.3},force:{type:"radial",boundary:{inner:500,outer:1500}},ignoreYear:!0}]},howTaxCreditWorksPart2:{description:"Part 2 of the tax credit flow visualization",dotRadius:7,forceStrength:{},sankeyGroups:[{sankey:l.parliamentToDonors,svgAnnotations:[{id:"tax-credit-annotation",type:"callout",target:l.parliamentToDonors,targetAnchorLink:"superdot-link",targetFlowGroup:"Donors >$1000",targetFlowRatio:.5,fixedPosition:{x:s().x+160,y:s().y-100},note:{title:"Tax credits",label:"Public money given back to donors through the Federal Political Contributions Tax Credit",wrap:180,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"elbow"},className:"blue-flow-annotation"}]},{sankey:l.donorsToParty}],images:[{image:c.partyIcon,position:{x:450,y:550}}],clumps:[{group:n.VOTER_GROUPS.DONORS_1_999,superdot:!0,force:{center:{x:250,y:350}}},{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{center:{x:450,y:350}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,render:{opacity:.3},force:{type:"radial",boundary:{inner:500,outer:1500}},ignoreYear:!0}]},howTaxCreditWorksOutOfPocket:{description:"View for the current donor flow visualization showing out-of-pocket portion",dotRadius:7,forceStrength:{},sankeyGroups:[{sankey:l.parliamentToDonors},{sankey:l.donorsToPartyOOP},{sankey:l.donorsToPartySubsidized}],images:[{image:c.partyIcon,position:{x:450,y:550}}],clumps:[{group:n.VOTER_GROUPS.DONORS_1_999,superdot:!0,force:{center:{x:250,y:350}}},{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{center:{x:450,y:350}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,render:{opacity:.3},force:{type:"radial",boundary:{inner:500,outer:1500}},ignoreYear:!0}]},howTaxCreditWorksOutOfPocket2:{description:"View for the current donor flow visualization showing out-of-pocket portion 2",dotRadius:7,forceStrength:{},sankeyGroups:[{sankey:l.parliamentToDonors},{sankey:l.donorsToPartyOOP},{sankey:l.donorsToPartySubsidized}],images:[{image:c.partyIcon,position:{x:350,y:550}}],clumps:[{group:n.VOTER_GROUPS.DONORS_1_999,superdot:!0,force:{center:{x:250,y:350}}},{group:n.VOTER_GROUPS.DONORS_OVER_1000,superdot:!0,force:{center:{x:450,y:350}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,render:{opacity:.3},force:{type:"radial",boundary:{inner:500,outer:1500}},ignoreYear:!0}]},bigDonorsGetNearlyHalfOfCredits:{description:"Big donors get nearly half of the tax credits",dotRadius:7,forceStrength:{},sankeyGroups:[{sankey:l.parliamentToDonors,svgAnnotations:[{id:"nearly-half-donations-annotation",type:"callout",target:l.parliamentToDonors,targetAnchorLink:"superdot-link",targetFlowGroup:"Donors >$1000",targetFlowRatio:.5,fixedPosition:{x:s().x+200,y:s().y-130},note:{title:"Tax credits for big donors",label:"Nearly half of the tax credits go back to the superdonor group",wrap:210,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"elbow"},className:"nearly-half-flow-annotation blue-flow-annotation"}]},{sankey:l.donorsToPartyOOP,svgAnnotations:[{id:"nearly-half-oop-annotation",type:"callout",targetAnchorLink:"superdot-link",targetFlowGroup:"Donors >$1000",targetFlowRatio:.8,fixedPosition:{x:s().x+260,y:s().y+150},note:{title:"And the wealthiest donors pay the least out of pocket",wrap:240,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"elbow"},className:"nearly-half-flow2-annotation green-flow-annotation"}]},{sankey:l.donorsToPartySubsidized,svgAnnotations:[{id:"nearly-half-subsidized-annotation",type:"callout",targetAnchorLink:"superdot-link",targetFlowGroup:"Donors >$1000",targetFlowRatio:.5,fixedPosition:{x:s().x+200,y:s().y+30},note:{title:"So your money is subsidizing their donations",wrap:240,bgPadding:10,align:"left"},connector:{end:"arrow",type:"elbow"},className:"nearly-half-subsidized-annotation blue-flow-annotation"}]}],images:[{image:c.partyIcon,position:{x:350,y:550}}],clumps:[{group:n.VOTER_GROUPS.DONORS_1_999,render:{opacity:.5},superdot:!0,force:{center:{x:250,y:350}}},{group:n.VOTER_GROUPS.DONORS_OVER_1000,force:{center:{x:450,y:350}},superdot:!0},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,render:{opacity:.3},force:{type:"radial",boundary:{inner:500,outer:1500}},ignoreYear:!0}]},aCatch:{description:"there's a catch",dotRadius:2,requireAverageYears:!0,forceStrength:{charge:-1},clumps:[{group:n.VOTER_GROUPS.ALL_ELIGIBLE,render:{opacity:1},force:{}}]},nonRefundable:{description:"The percentage of Canadians who would benefit from the tax credit",dotRadius:3,requireAverageYears:!0,forceStrength:{charge:-2},clumps:[{group:n.VOTER_GROUPS.ABOVE_TAX_THRESHOLD,render:{opacity:1},force:{type:"radial",boundary:{inner:150,outer:320}},groupColorOverride:[{group:n.VOTER_GROUPS.ABOVE_TAX_THRESHOLD,color:"rgba(0, 0, 0, 0.1)"}]},{group:n.VOTER_GROUPS.BELOW_TAX_THRESHOLD,superdot:!0,groupColorOverride:[{group:n.VOTER_GROUPS.BELOW_TAX_THRESHOLD,color:"#B5C617"}],svgAnnotations:[{id:"no-taxes-group-annotation",type:"calloutCircle",fixedPosition:{x:60,y:s().y-180},note:{title:"These people don't make enough money to end up owing taxes",wrap:250,bgPadding:10,align:"middle"},connector:{type:"line"},subject:{radiusPadding:0},className:"hidden-circle-annotation grape-annotation"}]}]},nonRefundable2:{description:"The percentage of Canadians who would benefit from the tax credit2",dotRadius:3,requireAverageYears:!0,clumps:[{group:n.VOTER_GROUPS.ABOVE_TAX_THRESHOLD,render:{opacity:.1},force:{type:"radial",boundary:{inner:150,outer:300}},groupColorOverride:[{group:n.VOTER_GROUPS.ABOVE_TAX_THRESHOLD,color:"rgba(0, 0, 0, 0.1)"}]},{group:n.VOTER_GROUPS.BELOW_TAX_THRESHOLD,superdot:!0,textAnnotations:[{text:"Not eligible for the tax credit",targetAnchorY:"top",targetOffset:{x:0,y:-20},color:"#B5C617"}],groupColorOverride:[{group:n.VOTER_GROUPS.BELOW_TAX_THRESHOLD,color:"#B5C617"}]}]},whatsTheSolution:{description:"So what can we do about it?",dotRadius:5,forceStrength:{charge:-5},clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000},{group:n.VOTER_GROUPS.DONORS_1_999,force:{type:"radial",boundary:{inner:60,outer:100}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:150,outer:300}},render:{opacity:1}},{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:400,outer:1500}},render:{opacity:.3}}]},capTheDonationLimit1:{description:"Cap the donation limit to $100",dotRadius:5,forceStrength:{charge:-5},images:[{image:c.partyIcon,position:{x:s().x,y:s().y},size:{width:70,height:70}}],clumps:[{group:n.VOTER_GROUPS.ALL_DONORS,force:{type:"radial",boundary:{inner:50,outer:100}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:150,outer:300}},render:{opacity:.3}},{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:400,outer:1500}},render:{opacity:.3}}],svgAnnotations:[{id:"right-now-donor-count",type:"calloutCircle",target:{x:s().x,y:s().y},fixedPosition:{x:100,y:s().y-160},note:{title:"Fundraising Focus",label:"With the current donation limit, parties can meet their fundraising goals with a handful of donors",wrap:250,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"line"},subject:{radiusPadding:5,includeElements:[n.VOTER_GROUPS.DONORS_OVER_1000,n.VOTER_GROUPS.DONORS_1_999,"bot-party-icon"]},className:"elite-donors-annotation"}]},capTheDonationLimit2:{description:"Then they have to connect to more voters",dotRadius:6,forceStrength:{charge:-6},requireAverageYears:!0,images:[{image:c.partyIcon,position:{x:s().x,y:s().y},size:{width:70,height:70}}],clumps:[{group:n.VOTER_GROUPS.ALL_DONORS_AFTER_REFORM,force:{type:"radial",boundary:{inner:50,outer:100}},groupColorOverride:[{group:n.VOTER_GROUPS.ALL_DONORS_AFTER_REFORM,color:"#B5C617"}]},{group:n.VOTER_GROUPS.NON_DONATING_WITH_REFORM,force:{type:"radial",boundary:{inner:150,outer:400}},render:{opacity:.3}},{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:420,outer:1500}},render:{opacity:.3}}],svgAnnotations:[{id:"with-reform-donor-count",type:"calloutCircle",target:{x:s().x,y:s().y},fixedPosition:{x:100,y:s().y-160},note:{title:"Double the Donors",label:"To make the same amount of money with the reduced limit, parties would need to connect with more than twice as many voters as they do now",wrap:250,bgPadding:10,align:"middle"},connector:{end:"arrow",type:"line"},subject:{radiusPadding:5,includeElements:[n.VOTER_GROUPS.DONORS_OVER_1000,n.VOTER_GROUPS.DONORS_1_999,n.VOTER_GROUPS.NON_DONATING_NEEDED_FOR_FUNDING,"bot-party-icon"]},className:"elite-donors-annotation"}]},bringBackPVS1:{description:"Bring back the per-vote subsidy 1",dotRadius:2,forceStrength:{charge:-.7},images:[{image:c.partyIcon,position:{x:s().x,y:s().y+220},size:{width:100,height:100}},{image:c.parliamentIcon,position:{x:s().x,y:s().y-260},size:{width:200,height:200}}],clumps:[{group:n.VOTER_GROUPS.ALL_VOTERS,superdot:!0}]},bringBackPVS2:{description:"Bring back the per-vote subsidy 2",dotRadius:2,forceStrength:{charge:-.7},images:[{image:c.partyIcon,position:{x:s().x,y:s().y+220},size:{width:100,height:100}},{image:c.parliamentIcon,position:{x:s().x,y:s().y-260},size:{width:200,height:200}}],sankeyGroups:[{sankey:l.votersAndDonorsSuperdotToParties},{sankey:l.parliamentToVotersAndDonorsSuperdot}],clumps:[{group:n.VOTER_GROUPS.ALL_VOTERS,superdot:!0}]},bringBackPVS3:{description:"Bring back the per-vote subsidy 3",dotRadius:5,forceStrength:{charge:-5},clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000},{group:n.VOTER_GROUPS.DONORS_1_999,force:{type:"radial",boundary:{inner:40,outer:50}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:100,outer:300}}},{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:400,outer:1500}},render:{opacity:.2}}]},bringBackPVS4:{description:"Bring back the per-vote subsidy 4",dotRadius:4,forceStrength:{charge:-3},clumps:[{group:n.VOTER_GROUPS.DONORS_OVER_1000},{group:n.VOTER_GROUPS.DONORS_1_999,force:{type:"radial",boundary:{inner:30,outer:40}}},{group:n.VOTER_GROUPS.NON_DONATING_VOTERS,force:{type:"radial",boundary:{inner:60,outer:230}}},{group:n.VOTER_GROUPS.ELIGIBLE_NON_VOTERS,force:{type:"radial",boundary:{inner:260,outer:800}},render:{opacity:1}}]}};for(const o in t){const n={...t[o],id:o};e.viewPresets[o]=n}}()};const n=o(921),i=o(569),r=o(636),a=o(3),s=()=>({x:i.state.svgWidth/2,y:i.state.svgHeight/2}),c={},l={};e.viewPresets={}},489:(t,e,o)=>{t.exports=o.p+"ecc574b7dcab4f1a8132.png"},487:(t,e,o)=>{t.exports=o.p+"0e2884683166703683ab.png"}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={id:n,exports:{}};return t[n](r,r.exports,o),r.exports}o.m=t,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),o.b=document.baseURI||self.location.href,o.nc=void 0,(()=>{o(376);const t=o(646),e=o(921),n=o(569),i=o(517),r=o(114),a=o(306),s=o(795);function c(){const t=document.getElementById("year-selector");t&&t.querySelectorAll(".year-button").forEach((t=>{const e=t,o=e.dataset.year||"",i=o===n.state.currentYear,r=n.state.yearHasDataForActiveTypes(o),a=n.state.lockedToAverageYears&&"Average 2016-2022"!==o;e.style.backgroundColor=i?"#833B8D":"#f0f0f0",e.style.color=i?"white":"#333",e.style.opacity=r&&!a?"1":"0.3",e.style.pointerEvents=r&&!a?"auto":"none",e.disabled=!r||a}))}window.updateYearSelectorUI=c,async function(){console.log("Main function started"),(0,e.createVoterGroups)(),n.state.importedData=await(0,t.loadVoterData)("assets/csv/voters.csv"),n.state.flattenedData=(0,t.flattenData)(n.state.importedData),console.log("Imported data:",n.state.importedData),(0,a.initializeViewComponents)(),(0,r.initVisualization)("chart1"),(0,i.initSimulation)(),function(){const t=document.createElement("div");t.id="year-selector",t.style.position="fixed",t.style.bottom="80px",t.style.right="20px",t.style.display="flex",t.style.flexDirection="row",t.style.alignItems="flex-end",t.style.gap="5px",t.style.zIndex="10000",n.state.availableYears.forEach((e=>{const o=document.createElement("button");o.textContent=e,o.dataset.year=e,o.classList.add("year-button"),o.style.padding="4px 8px",o.style.margin="2px",o.style.borderRadius="4px",o.style.cursor="pointer",o.style.backgroundColor=e===n.state.currentYear?"#833B8D":"#f0f0f0",o.style.color=e===n.state.currentYear?"white":"#333",o.style.border="none",o.style.fontFamily="sans-serif",o.style.fontSize="12px",o.addEventListener("click",(()=>{n.state.setYear(e),c()})),t.appendChild(o)})),document.body.appendChild(t)}(),(0,s.initEventListeners)(),(0,s.setViewFromVisibleTriggers)()}()})()})();